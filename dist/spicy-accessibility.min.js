!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("SpicyAccessibility",[],t):"object"==typeof exports?exports.SpicyAccessibility=t():e.SpicyAccessibility=t()}(this,(()=>(()=>{"use strict";var e={d:(t,i)=>{for(var s in i)e.o(i,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:i[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=document.createElement(e);return t.id&&(i.id=t.id),t.className&&(Array.isArray(t.className)?i.classList.add(...t.className):i.className=t.className),t.attributes&&Object.entries(t.attributes).forEach((e=>{let[t,s]=e;i.setAttribute(t,s)})),t.properties&&Object.entries(t.properties).forEach((e=>{let[t,s]=e;i[t]=s})),t.dataset&&Object.entries(t.dataset).forEach((e=>{let[t,s]=e;i.dataset[t]=s})),t.style&&Object.entries(t.style).forEach((e=>{let[t,s]=e;i.style[t]=s})),void 0!==t.textContent&&(i.textContent=t.textContent),void 0!==t.innerHTML&&(i.innerHTML=t.innerHTML),t.children&&t.children.forEach((e=>{i.appendChild(e)})),i}e.d(t,{default:()=>u});class s{constructor(e,t,i){this.config=e,this.settings=t,this.events=i,this.featureModules=[],this.isOpen=!1,this.togglePanel=this.togglePanel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.events.on("settings:changed",this.updateUI.bind(this)),document.body?this.render():document.addEventListener("DOMContentLoaded",(()=>{this.render()}))}registerFeatureModule(e){this.featureModules.push(e)}render(){console.log("Rendering widget..."),function(){if(document.getElementById("spicy-global-styles"))return;const e=document.createElement("link");e.rel="stylesheet",e.href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css",document.head.appendChild(e);const t=document.createElement("style");t.id="spicy-global-styles",t.textContent="\n    .keyboard-focus {\n      outline: 3px solid #4361ee !important;\n      outline-offset: 2px !important;\n    }\n  ",document.head.appendChild(t)}(),this.createToggleButton(),this.createPanel(),document.addEventListener("keydown",this.handleKeydown),this.featureModules.forEach((e=>e.init())),this.addFocusListeners()}createToggleButton(){console.log("Creating toggle button..."),this.toggleButton=i("button",{id:"spicy-access-btn",innerHTML:'<i class="fa-solid fa-universal-access" aria-hidden="true"></i><span class="spicy-btn-text">A11Y</span>',style:{position:"fixed",bottom:"20px",right:"20px",zIndex:"9999",width:"auto",minWidth:"56px",height:"56px",borderRadius:"28px",backgroundColor:"#4361ee",color:"white",border:"none",cursor:"pointer",boxShadow:"0 4px 16px rgba(0,0,0,0.2)",display:"flex",alignItems:"center",justifyContent:"center",padding:"0 15px"},attributes:{"aria-label":"Open accessibility menu",title:"Accessibility Options (Alt+A)"}}),this.applyButtonPosition(),this.toggleButton.addEventListener("click",this.togglePanel),document.body.appendChild(this.toggleButton)}applyButtonPosition(){this.toggleButton.style.top="",this.toggleButton.style.bottom="",this.toggleButton.style.left="",this.toggleButton.style.right="";const e=this.config.position||"bottom-right";e.includes("top")?this.toggleButton.style.top="20px":this.toggleButton.style.bottom="20px",e.includes("left")?this.toggleButton.style.left="20px":this.toggleButton.style.right="20px"}createPanel(){this.panel=i("div",{id:"spicy-access-panel",attributes:{"aria-hidden":"true",role:"dialog","aria-labelledby":"spicy-panel-title"}});const e=i("div",{className:"spicy-panel-header",innerHTML:'\n        <h2 id="spicy-panel-title">Accessibility Settings</h2>\n        <button id="spicy-close-btn" aria-label="Close menu">\n          <i class="fa-solid fa-xmark"></i>\n        </button>\n      '});this.panelContent=i("div",{className:"spicy-panel-content"});const t=i("div",{className:"spicy-panel-footer",innerHTML:'\n        <button class="spicy-btn spicy-reset" id="spicy-reset-all">\n          <i class="fa-solid fa-arrows-rotate"></i> Reset All\n        </button>\n        <p class="spicy-branding">üç© Powered by SpicyDonut</p>\n      '});this.panel.appendChild(e),this.panel.appendChild(this.panelContent),this.panel.appendChild(t),e.querySelector("#spicy-close-btn").addEventListener("click",this.togglePanel),t.querySelector("#spicy-reset-all").addEventListener("click",(()=>{this.settings.resetAll()})),this.applyPanelPosition(),document.body.appendChild(this.panel),this.populatePanel()}applyPanelPosition(){this.panel.style.top="",this.panel.style.bottom="",this.panel.style.left="",this.panel.style.right="";const e=this.config.position||"bottom-right";e.includes("top")?this.panel.style.top="85px":this.panel.style.bottom="85px",e.includes("left")?this.panel.style.left="20px":this.panel.style.right="20px"}populatePanel(){this.panelContent.innerHTML="",this.featureModules.forEach((e=>{const t=e.renderSection();t&&this.panelContent.appendChild(t)}))}togglePanel(e){this.isOpen="boolean"==typeof e?e:!this.isOpen,this.isOpen?(this.panel.classList.add("visible"),this.panel.setAttribute("aria-hidden","false"),setTimeout((()=>{const e=this.panel.querySelector('button, [tabindex="0"]');e&&e.focus()}),100)):(this.panel.classList.remove("visible"),this.panel.setAttribute("aria-hidden","true"),this.toggleButton.focus()),this.events.emit("panel:"+(this.isOpen?"opened":"closed"))}openPanel(){this.togglePanel(!0)}closePanel(){this.togglePanel(!1)}handleKeydown(e){const t=(this.config.keyboardShortcut||"alt+a").toLowerCase().split("+"),i="alt"===t[0]?e.altKey:"ctrl"===t[0]?e.ctrlKey:"shift"===t[0]&&e.shiftKey,s=t[1];i&&e.key.toLowerCase()===s&&(e.preventDefault(),this.togglePanel()),"Escape"===e.key&&this.isOpen&&this.closePanel()}updateUI(e){this.featureModules.forEach((t=>{t.updateUI(e)}))}addFocusListeners(){document.querySelectorAll("#spicy-access-panel button, #spicy-access-panel input, #spicy-access-panel select").forEach((e=>{e.addEventListener("focus",(()=>{e.classList.add("keyboard-focus")})),e.addEventListener("blur",(()=>{e.classList.remove("keyboard-focus")}))}))}}class n{constructor(e,t){this.storage=e,this.events=t,this.settings={},this.profiles={},this.defaultSettings={fontSize:100,lineHeight:!1,letterSpacing:!1,dyslexicFont:!1,contrast:!1,darkMode:!1,lightMode:!1,grayscale:!1,highlightLinks:!1,readingGuide:!1,hideImages:!1,pauseAnimations:!1,bigCursor:!1,focusIndicator:!1,pageStructure:!1,textToSpeech:!1,tooltips:!1}}load(){const e=this.storage.getItem("spicySettings");this.settings=e?JSON.parse(e):{...this.defaultSettings};const t=this.storage.getItem("spicyProfiles");this.profiles=t?JSON.parse(t):this.getDefaultProfiles(),this.events.emit("settings:loaded",this.settings)}getDefaultProfiles(){return{default:{...this.defaultSettings},highContrast:{...this.defaultSettings,contrast:!0,highlightLinks:!0,focusIndicator:!0},dyslexic:{...this.defaultSettings,dyslexicFont:!0,lineHeight:!0,letterSpacing:!0,fontSize:120},senior:{...this.defaultSettings,fontSize:150,highlightLinks:!0,bigCursor:!0,focusIndicator:!0},lowVision:{...this.defaultSettings,fontSize:175,contrast:!0,highlightLinks:!0,bigCursor:!0},motor:{...this.defaultSettings,bigCursor:!0,focusIndicator:!0,pauseAnimations:!0},cognitive:{...this.defaultSettings,readingGuide:!0,pauseAnimations:!0,lineHeight:!0}}}save(){this.storage.setItem("spicySettings",JSON.stringify(this.settings)),this.events.emit("settings:saved",this.settings)}updateSetting(e,t){this.settings[e]=t,this.save(),this.events.emit("settings:changed",this.settings,{key:e,value:t})}updateSettings(e){Object.assign(this.settings,e),this.save(),this.events.emit("settings:changed",this.settings,{updates:e})}getSetting(e){return this.settings[e]}getAll(){return{...this.settings}}resetAll(){this.settings={...this.defaultSettings},this.save(),this.events.emit("settings:reset",this.settings)}loadProfile(e){this.profiles[e]?(this.settings={...this.profiles[e]},this.save(),this.events.emit("settings:profile:loaded",e,this.settings)):console.warn(`Profile "${e}" not found`)}saveProfile(e){return"default"===e?(console.warn("Cannot overwrite the default profile"),!1):(this.profiles[e]={...this.settings},this.storage.setItem("spicyProfiles",JSON.stringify(this.profiles)),this.events.emit("settings:profile:saved",e,this.settings),!0)}deleteProfile(e){return["default","highContrast","dyslexic","senior","lowVision","motor","cognitive"].includes(e)?(console.warn(`Cannot delete built-in profile "${e}"`),!1):!!this.profiles[e]&&(delete this.profiles[e],this.storage.setItem("spicyProfiles",JSON.stringify(this.profiles)),this.events.emit("settings:profile:deleted",e),!0)}getProfiles(){return{...this.profiles}}}class a{constructor(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.prefix="spicy-",this.autoSave=e,this.isAvailable=this.checkAvailability()}checkAvailability(){try{const e=`${this.prefix}test`;return localStorage.setItem(e,"test"),localStorage.removeItem(e),!0}catch(e){return console.warn("Local storage is not available:",e),!1}}getItem(e){if(!this.isAvailable)return null;try{return localStorage.getItem(`${this.prefix}${e}`)}catch(t){return console.error(`Error retrieving ${e} from storage:`,t),null}}setItem(e,t){if(!this.isAvailable||!this.autoSave)return!1;try{return localStorage.setItem(`${this.prefix}${e}`,t),!0}catch(t){return console.error(`Error saving ${e} to storage:`,t),!1}}removeItem(e){if(!this.isAvailable)return!1;try{return localStorage.removeItem(`${this.prefix}${e}`),!0}catch(t){return console.error(`Error removing ${e} from storage:`,t),!1}}clear(){if(!this.isAvailable)return!1;try{return Object.keys(localStorage).forEach((e=>{e.startsWith(this.prefix)&&localStorage.removeItem(e)})),!0}catch(e){return console.error("Error clearing storage:",e),!1}}}class o{constructor(){this.listeners=new Map}on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set);const i=this.listeners.get(e);return i.add(t),()=>{i.delete(t),0===i.size&&this.listeners.delete(e)}}once(e,t){const i=this.on(e,(function(){i(),t(...arguments)}));return i}off(e,t){const i=this.listeners.get(e);if(!i)return!1;const s=i.delete(t);return 0===i.size&&this.listeners.delete(e),s}emit(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];const n=this.listeners.get(e);n&&n.forEach((t=>{try{t(...i)}catch(t){console.error(`Error in event handler for ${e}:`,t)}}));const a=this.listeners.get("*");a&&a.forEach((t=>{try{t(e,...i)}catch(t){console.error(`Error in wildcard event handler for ${e}:`,t)}}))}clear(e){e?this.listeners.delete(e):this.listeners.clear()}listenerCount(e){const t=this.listeners.get(e);return t?t.size:0}}const l=new Set;class r{constructor(e,t){this.settings=e,this.events=t,this.features=[{id:"fontSize",name:"Text Size",icon:"fa-solid fa-text-height",type:"slider",min:80,max:200,step:10,default:100},{id:"dyslexicFont",name:"Dyslexia Font",icon:"fa-solid fa-font",type:"toggle"},{id:"lineHeight",name:"Line Spacing",icon:"fa-solid fa-arrows-up-down",type:"toggle"},{id:"letterSpacing",name:"Letter Spacing",icon:"fa-solid fa-arrows-left-right",type:"toggle"}],this.enabledFeatures=[...this.features]}init(){!function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=`${e}-${t}`;if(l.has(s))return Promise.resolve();const{fontStyle:n="normal",fontWeight:a="normal",fontDisplay:o="swap"}=i,r=`\n    @font-face {\n      font-family: '${e}';\n      src: url('${t}') format('woff2'),\n           url('${t}') format('woff');\n      font-style: ${n};\n      font-weight: ${a};\n      font-display: ${o};\n    }\n  `,c=document.createElement("style");if(c.textContent=r,document.head.appendChild(c),"FontFace"in window)return new FontFace(e,`url(${t})`,{style:n,weight:a,display:o}).load().then((e=>{document.fonts.add(e),l.add(s)})).catch((t=>{console.error(`Error loading font ${e}:`,t)}));new Promise((t=>{const i=document.createElement("span");i.style.fontFamily=`'${e}', monospace`,i.style.fontSize="0",i.style.visibility="hidden",i.textContent="Font loaded test",document.body.appendChild(i),setTimeout((()=>{document.body.removeChild(i),l.add(s),t()}),50)}))}("OpenDyslexic","https://cdn.jsdelivr.net/npm/open-dyslexic@1.0.3/open-dyslexic-regular.woff"),this.applySettings(this.settings.getAll()),this.events.on("settings:changed",this.applySettings.bind(this))}applySettings(e){document.documentElement.style.setProperty("--spicy-font-size",`${e.fontSize}%`),document.body.classList.toggle("spicy-dyslexic",e.dyslexicFont),document.body.classList.toggle("spicy-line-height",e.lineHeight),document.body.classList.toggle("spicy-letter-spacing",e.letterSpacing)}renderSection(){if(0===this.enabledFeatures.length)return null;const e=i("div",{className:"spicy-section",innerHTML:'<h3><i class="fa-solid fa-book-open-reader"></i> Text & Reading</h3>'}),t=this.enabledFeatures.find((e=>"fontSize"===e.id));if(t){const i=this.createFontSizeControl(t);e.appendChild(i)}const s=i("div",{className:"spicy-grid"});return this.enabledFeatures.filter((e=>"toggle"===e.type)).forEach((e=>{const t=this.createFeatureButton(e);s.appendChild(t)})),s.children.length>0&&e.appendChild(s),e}createFontSizeControl(e){const t=i("div",{className:"spicy-control-group"}),s=i("button",{className:"spicy-btn spicy-icon-btn",id:"spicy-font-decrease",innerHTML:'<i class="fa-solid fa-minus"></i>',attributes:{"aria-label":"Decrease font size"}}),n=i("div",{className:"spicy-slider-container"}),a=i("input",{id:"spicy-font-slider",attributes:{type:"range",min:e.min,max:e.max,step:e.step,value:this.settings.getSetting("fontSize"),"aria-labelledby":"spicy-font-size-label"}}),o=i("span",{id:"spicy-font-size-label",textContent:`${this.settings.getSetting("fontSize")}%`}),l=i("button",{className:"spicy-btn spicy-icon-btn",id:"spicy-font-increase",innerHTML:'<i class="fa-solid fa-plus"></i>',attributes:{"aria-label":"Increase font size"}});return n.appendChild(a),n.appendChild(o),t.appendChild(s),t.appendChild(n),t.appendChild(l),a.addEventListener("input",(()=>{const e=a.value;this.settings.updateSetting("fontSize",parseInt(e)),o.textContent=`${e}%`})),s.addEventListener("click",(()=>{const t=Math.max(e.min,parseInt(a.value)-e.step);a.value=t,this.settings.updateSetting("fontSize",t),o.textContent=`${t}%`})),l.addEventListener("click",(()=>{const t=Math.min(e.max,parseInt(a.value)+e.step);a.value=t,this.settings.updateSetting("fontSize",t),o.textContent=`${t}%`})),t}createFeatureButton(e){const t=i("button",{className:"spicy-feature-btn",id:`spicy-${e.id}`,innerHTML:`\n        <i class="${e.icon}"></i>\n        <span>${e.name}</span>\n      `});return this.settings.getSetting(e.id)&&t.classList.add("active"),t.addEventListener("click",(()=>{const i=t.classList.toggle("active");this.settings.updateSetting(e.id,i)})),t}updateUI(e){const t=document.getElementById("spicy-font-slider"),i=document.getElementById("spicy-font-size-label");t&&i&&(t.value=e.fontSize,i.textContent=`${e.fontSize}%`),this.features.filter((e=>"toggle"===e.type)).forEach((t=>{const i=document.getElementById(`spicy-${t.id}`);i&&i.classList.toggle("active",e[t.id])}))}}class c{constructor(e,t){this.settings=e,this.events=t,this.features=[{id:"contrast",name:"High Contrast",icon:"fa-solid fa-adjust",type:"toggle"},{id:"darkMode",name:"Dark Mode",icon:"fa-solid fa-moon",type:"toggle"},{id:"lightMode",name:"Light Mode",icon:"fa-solid fa-sun",type:"toggle"},{id:"grayscale",name:"Grayscale",icon:"fa-solid fa-brush",type:"toggle"},{id:"highlightLinks",name:"Highlight Links",icon:"fa-solid fa-link",type:"toggle"},{id:"hideImages",name:"Hide Images",icon:"fa-solid fa-image-slash",type:"toggle"},{id:"pauseAnimations",name:"Stop Animations",icon:"fa-solid fa-pause",type:"toggle"},{id:"bigCursor",name:"Large Cursor",icon:"fa-solid fa-mouse-pointer",type:"toggle"},{id:"focusIndicator",name:"Focus Indicator",icon:"fa-solid fa-bullseye",type:"toggle"}],this.enabledFeatures=[...this.features]}init(){this.applySettings(this.settings.getAll()),this.events.on("settings:changed",this.applySettings.bind(this)),this.handleColorSchemePreference()}applySettings(e){document.body.classList.toggle("spicy-contrast",e.contrast),document.body.classList.toggle("spicy-dark-mode",e.darkMode),document.body.classList.toggle("spicy-light-mode",e.lightMode),document.body.classList.toggle("spicy-grayscale",e.grayscale),document.body.classList.toggle("spicy-highlight-links",e.highlightLinks),document.body.classList.toggle("spicy-hide-images",e.hideImages),document.body.classList.toggle("spicy-pause-animations",e.pauseAnimations),document.body.classList.toggle("spicy-big-cursor",e.bigCursor),document.body.classList.toggle("spicy-focus-indicator",e.focusIndicator)}handleColorSchemePreference(){const e=window.matchMedia("(prefers-color-scheme: dark)");e.matches&&!1===this.settings.getSetting("darkMode")&&!1===this.settings.getSetting("lightMode")&&this.settings.updateSetting("darkMode",!0),e.addEventListener("change",(e=>{!1===this.settings.getSetting("darkMode")&&!1===this.settings.getSetting("lightMode")&&this.settings.updateSetting("darkMode",e.matches)}))}renderSection(){if(0===this.enabledFeatures.length)return null;const e=i("div",{className:"spicy-section",innerHTML:'<h3><i class="fa-solid fa-circle-half-stroke"></i> Visual Display</h3>'}),t=i("div",{className:"spicy-grid"}),s=["contrast","darkMode","lightMode","grayscale"],n=["highlightLinks","hideImages","pauseAnimations","bigCursor","focusIndicator"];return this.enabledFeatures.filter((e=>s.includes(e.id))).forEach((e=>{const i=this.createFeatureButton(e);t.appendChild(i)})),this.enabledFeatures.filter((e=>n.includes(e.id))).forEach((e=>{const i=this.createFeatureButton(e);t.appendChild(i)})),t.children.length>0&&e.appendChild(t),e}createFeatureButton(e){const t=i("button",{className:"spicy-feature-btn",id:`spicy-${e.id}`,innerHTML:`\n        <i class="${e.icon}"></i>\n        <span>${e.name}</span>\n      `});return this.settings.getSetting(e.id)&&t.classList.add("active"),t.addEventListener("click",(()=>{const i=t.classList.toggle("active");if(i)if("darkMode"===e.id&&this.settings.getSetting("lightMode")){this.settings.updateSetting("lightMode",!1);const e=document.getElementById("spicy-lightMode");e&&e.classList.remove("active")}else if("lightMode"===e.id&&this.settings.getSetting("darkMode")){this.settings.updateSetting("darkMode",!1);const e=document.getElementById("spicy-darkMode");e&&e.classList.remove("active")}this.settings.updateSetting(e.id,i)})),t}updateUI(e){this.features.forEach((t=>{const i=document.getElementById(`spicy-${t.id}`);i&&i.classList.toggle("active",e[t.id])}))}}class d{constructor(e,t){this.settings=e,this.events=t,this.features=[{id:"pageStructure",name:"Page Structure",icon:"fa-solid fa-sitemap",type:"toggle"},{id:"readingGuide",name:"Reading Guide",icon:"fa-solid fa-ruler-horizontal",type:"toggle"},{id:"tooltips",name:"Show Tooltips",icon:"fa-solid fa-comment",type:"toggle"}],this.enabledFeatures=[...this.features],this.handlers={}}init(){this.applySettings(this.settings.getAll()),this.events.on("settings:changed",this.applySettings.bind(this))}applySettings(e){e.pageStructure!==this.lastSettings?.pageStructure&&(e.pageStructure?this.showPageStructure():this.hidePageStructure()),e.readingGuide!==this.lastSettings?.readingGuide&&(e.readingGuide?this.createReadingGuide():this.removeReadingGuide()),document.body.classList.toggle("spicy-tooltips",e.tooltips),this.lastSettings={...e}}renderSection(){if(0===this.enabledFeatures.length)return null;const e=i("div",{className:"spicy-section",innerHTML:'<h3><i class="fa-solid fa-sitemap"></i> Navigation</h3>'}),t=i("div",{className:"spicy-grid"});return this.enabledFeatures.forEach((e=>{const i=this.createFeatureButton(e);t.appendChild(i)})),t.children.length>0&&e.appendChild(t),e}createFeatureButton(e){const t=i("button",{className:"spicy-feature-btn",id:`spicy-${e.id}`,innerHTML:`\n        <i class="${e.icon}"></i>\n        <span>${e.name}</span>\n      `});return this.settings.getSetting(e.id)&&t.classList.add("active"),t.addEventListener("click",(()=>{const i=t.classList.toggle("active");this.settings.updateSetting(e.id,i)})),t}updateUI(e){this.features.forEach((t=>{const i=document.getElementById(`spicy-${t.id}`);i&&i.classList.toggle("active",e[t.id])}))}showPageStructure(){if(document.getElementById("spicy-structure-panel"))return void(document.getElementById("spicy-structure-panel").style.display="block");const e=i("div",{id:"spicy-structure-panel",innerHTML:'\n        <h3>Page Structure</h3>\n        <div class="spicy-panel-header">\n          <button id="spicy-structure-close" aria-label="Close structure panel">\n            <i class="fa-solid fa-xmark"></i>\n          </button>\n        </div>\n        <ul id="spicy-structure-list"></ul>\n      '});e.querySelector("#spicy-structure-close").addEventListener("click",(()=>{this.settings.updateSetting("pageStructure",!1);const e=document.getElementById("spicy-pageStructure");e&&e.classList.remove("active")})),this.handlers.structureFocusTrap=function(e){const t=e.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(0===t.length)return()=>{};const i=t[0],s=t[t.length-1],n=e=>{"Tab"===e.key&&(e.shiftKey?document.activeElement===i&&(e.preventDefault(),s.focus()):document.activeElement===s&&(e.preventDefault(),i.focus()))};return e.addEventListener("keydown",n),()=>{e.removeEventListener("keydown",n)}}(e),document.body.appendChild(e),this.populateStructurePanel()}populateStructurePanel(){const e=document.getElementById("spicy-structure-list");if(!e)return;e.innerHTML="";const t=document.querySelectorAll("h1, h2, h3, h4, h5, h6");0!==t.length?t.forEach(((t,s)=>{const n=i("li",{className:`heading-level-${t.tagName.charAt(1)}`,textContent:t.textContent.trim()||`[Empty heading ${s+1}]`});n.addEventListener("click",(()=>{let e=t.id;e||(e=`spicy-heading-${s}`,t.id=e),t.scrollIntoView({behavior:"smooth"}),t.setAttribute("tabindex","-1"),t.focus(),t.hasAttribute("id")||setTimeout((()=>{t.removeAttribute("id")}),1e3)})),e.appendChild(n)})):e.innerHTML='<li class="spicy-no-headings">No headings found on this page</li>'}hidePageStructure(){const e=document.getElementById("spicy-structure-panel");e&&(e.style.display="none"),this.handlers.structureFocusTrap&&(this.handlers.structureFocusTrap(),delete this.handlers.structureFocusTrap)}createReadingGuide(){if(document.getElementById("spicy-reading-guide"))return void(document.getElementById("spicy-reading-guide").style.display="block");const e=i("div",{id:"spicy-reading-guide"});document.body.appendChild(e),this.handlers.readingGuideHandler=t=>{e&&(e.style.display="block",e.style.top=t.clientY-20+"px")},document.addEventListener("mousemove",this.handlers.readingGuideHandler)}removeReadingGuide(){const e=document.getElementById("spicy-reading-guide");e&&(e.style.display="none"),this.handlers.readingGuideHandler&&(document.removeEventListener("mousemove",this.handlers.readingGuideHandler),delete this.handlers.readingGuideHandler)}}class h{constructor(e,t){this.settings=e,this.events=t,this.features=[{id:"textToSpeech",name:"Screen Reader",icon:"fa-solid fa-volume-high",type:"toggle"}],this.enabledFeatures=[...this.features],this.isSpeaking=!1,this.selectedVoice=null,this.readingRate=1}init(){this.isSpeechAvailable="speechSynthesis"in window,this.isSpeechAvailable||(console.warn("Speech synthesis not available in this browser"),this.enabledFeatures=this.enabledFeatures.filter((e=>"textToSpeech"!==e.id))),this.applySettings(this.settings.getAll()),this.events.on("settings:changed",this.applySettings.bind(this)),this.events.on("panel:closed",(()=>{this.isSpeaking&&(window.speechSynthesis.cancel(),this.isSpeaking=!1)}))}applySettings(e){e.textToSpeech!==this.lastSettings?.textToSpeech&&(e.textToSpeech?this.initializeScreenReader():this.disableScreenReader()),this.lastSettings={...e}}renderSection(){if(0===this.enabledFeatures.length||!this.isSpeechAvailable)return null;const e=i("div",{className:"spicy-section",innerHTML:'<h3><i class="fa-solid fa-headphones"></i> Audio & Speech</h3>'}),t=i("div",{className:"spicy-grid"});return this.enabledFeatures.forEach((e=>{const i=this.createFeatureButton(e);t.appendChild(i)})),t.children.length>0&&e.appendChild(t),e}createFeatureButton(e){const t=i("button",{className:"spicy-feature-btn",id:`spicy-${e.id}`,innerHTML:`\n        <i class="${e.icon}"></i>\n        <span>${e.name}</span>\n      `});return this.settings.getSetting(e.id)&&t.classList.add("active"),t.addEventListener("click",(()=>{const i=t.classList.toggle("active");this.settings.updateSetting(e.id,i)})),t}updateUI(e){this.features.forEach((t=>{const i=document.getElementById(`spicy-${t.id}`);i&&i.classList.toggle("active",e[t.id])}))}initializeScreenReader(){if(!this.isSpeechAvailable)return;if(document.getElementById("spicy-reader-controls"))return void(document.getElementById("spicy-reader-controls").style.display="flex");const e=i("div",{id:"spicy-reader-controls",innerHTML:'\n        <button id="spicy-reader-play" aria-label="Play screen reader">\n          <i class="fa-solid fa-play"></i>\n        </button>\n        <button id="spicy-reader-pause" aria-label="Pause screen reader">\n          <i class="fa-solid fa-pause"></i>\n        </button>\n        <button id="spicy-reader-stop" aria-label="Stop screen reader">\n          <i class="fa-solid fa-stop"></i>\n        </button>\n        <select id="spicy-reader-voice" aria-label="Select voice"></select>\n        <input type="range" id="spicy-reader-rate" aria-label="Reading speed" min="0.5" max="2" step="0.1" value="1">\n      '});document.body.appendChild(e),this.populateVoices(),document.getElementById("spicy-reader-play").addEventListener("click",(()=>{this.readSelectedText()})),document.getElementById("spicy-reader-pause").addEventListener("click",(()=>{window.speechSynthesis.speaking&&(this.isSpeaking?(window.speechSynthesis.pause(),this.isSpeaking=!1):(window.speechSynthesis.resume(),this.isSpeaking=!0))})),document.getElementById("spicy-reader-stop").addEventListener("click",(()=>{window.speechSynthesis.cancel(),this.isSpeaking=!1})),document.getElementById("spicy-reader-rate").addEventListener("input",(e=>{this.readingRate=parseFloat(e.target.value)})),document.getElementById("spicy-reader-voice").addEventListener("change",(e=>{this.selectedVoice=e.target.value})),document.addEventListener("mouseup",(()=>{const e=window.getSelection();e&&e.toString().trim().length>0?document.getElementById("spicy-reader-play").classList.add("active"):document.getElementById("spicy-reader-play").classList.remove("active")}))}populateVoices(){if(!this.isSpeechAvailable)return;const e=document.getElementById("spicy-reader-voice");if(!e)return;e.innerHTML="";const t=window.speechSynthesis.getVoices();t.forEach(((t,s)=>{const n=i("option",{value:s,textContent:`${t.name} (${t.lang})`});e.appendChild(n)})),t.length>0&&(this.selectedVoice=0)}readSelectedText(){if(!this.isSpeechAvailable)return;const e=window.getSelection().toString();if(!e)return void alert("Please select text to read aloud");const t=new SpeechSynthesisUtterance(e),i=window.speechSynthesis.getVoices();i.length>0&&null!==this.selectedVoice&&(t.voice=i[this.selectedVoice]),t.rate=this.readingRate,t.onstart=()=>{this.isSpeaking=!0},t.onend=()=>{this.isSpeaking=!1},t.onerror=e=>{console.error("Speech synthesis error:",e),this.isSpeaking=!1},window.speechSynthesis.cancel(),window.speechSynthesis.speak(t)}disableScreenReader(){this.isSpeechAvailable&&(window.speechSynthesis.cancel(),this.isSpeaking=!1);const e=document.getElementById("spicy-reader-controls");e&&(e.style.display="none")}}class p{constructor(e,t){this.settings=e,this.events=t,this.features=[]}init(){this.events.on("settings:profile:loaded",this.handleProfileLoaded.bind(this)),this.events.on("settings:profile:saved",this.handleProfileSaved.bind(this)),this.events.on("settings:profile:deleted",this.handleProfileDeleted.bind(this))}renderSection(){const e=i("div",{className:"spicy-section",innerHTML:'<h3><i class="fa-solid fa-user-gear"></i> Profiles</h3>'}),t=i("div",{className:"spicy-profile-controls"}),s=i("select",{id:"spicy-profile-select",attributes:{"aria-label":"Select accessibility profile"}});this.populateProfileSelect(s);const n=i("button",{className:"spicy-btn",id:"spicy-save-profile",innerHTML:'<i class="fa-solid fa-floppy-disk"></i> Save'}),a=i("button",{className:"spicy-btn spicy-reset",id:"spicy-delete-profile",innerHTML:'<i class="fa-solid fa-trash"></i>',style:{padding:"8px 12px"}});s.addEventListener("change",(()=>{const e=s.value;this.settings.loadProfile(e)})),n.addEventListener("click",(()=>{this.saveCurrentProfile()})),a.addEventListener("click",(()=>{this.deleteCurrentProfile()})),t.appendChild(s),t.appendChild(n),t.appendChild(a);const o=i("div",{style:{marginTop:"10px",display:"flex",gap:"8px"}}),l=i("input",{id:"spicy-custom-profile-name",attributes:{type:"text",placeholder:"Create new profile...","aria-label":"New profile name"},style:{flexGrow:"1",padding:"8px 12px",borderRadius:"6px",border:"1px solid var(--spicy-border)",fontSize:"14px"}}),r=i("button",{className:"spicy-btn",id:"spicy-create-profile",innerHTML:'<i class="fa-solid fa-plus"></i> Create',style:{whiteSpace:"nowrap"}});return r.addEventListener("click",(()=>{this.createNewProfile()})),o.appendChild(l),o.appendChild(r),e.appendChild(t),e.appendChild(o),e}populateProfileSelect(e){e.innerHTML="";const t=this.settings.getProfiles();Object.keys(t).forEach((t=>{const s=i("option",{value:t,textContent:this.formatProfileName(t)});e.appendChild(s)}));const s=this.getCurrentProfileName();e.value=s||"default"}formatProfileName(e){const t={default:"Default",highContrast:"High Contrast",dyslexic:"Dyslexia-friendly",senior:"Senior-friendly",lowVision:"Low Vision",motor:"Motor Disabilities",cognitive:"Cognitive Support"};return e in t?t[e]:e.replace(/([A-Z])/g," $1").replace(/^./,(e=>e.toUpperCase()))}getCurrentProfileName(){const e=this.settings.getAll(),t=this.settings.getProfiles();for(const[i,s]of Object.entries(t)){if(Object.entries(s).every((t=>{let[i,s]=t;return e[i]===s})))return i}return null}saveCurrentProfile(){const e=document.getElementById("spicy-profile-select").value;if("default"===e){const e=prompt("Cannot overwrite the default profile. Enter a name for your custom profile:");if(!e)return;if(this.settings.saveProfile(e))return void this.updateProfileSelect(e)}else{if(!window.confirm(`Are you sure you want to overwrite the "${this.formatProfileName(e)}" profile?`))return;this.settings.saveProfile(e)}}createNewProfile(){const e=document.getElementById("spicy-custom-profile-name"),t=e.value.trim();if(!t)return void alert("Please enter a name for your profile");this.settings.saveProfile(t)&&(e.value="",this.updateProfileSelect(t))}deleteCurrentProfile(){const e=document.getElementById("spicy-profile-select").value;if(["default","highContrast","dyslexic","senior","lowVision","motor","cognitive"].includes(e))return void alert(`Cannot delete the built-in "${this.formatProfileName(e)}" profile`);if(!window.confirm(`Are you sure you want to delete the "${this.formatProfileName(e)}" profile?`))return;this.settings.deleteProfile(e)&&(this.settings.loadProfile("default"),this.updateProfileSelect("default"))}updateProfileSelect(e){const t=document.getElementById("spicy-profile-select");this.populateProfileSelect(t),t.value=e}handleProfileLoaded(e){const t=document.getElementById("spicy-profile-select");t&&(t.value=e)}handleProfileSaved(e){document.getElementById("spicy-profile-select")&&this.updateProfileSelect(e)}handleProfileDeleted(){document.getElementById("spicy-profile-select")&&this.updateProfileSelect("default")}}const g={position:"bottom-right",features:"all",initialProfile:"default",language:"en",theme:"light",keyboardShortcut:"alt+a",autoSave:!0,debug:!0},u={init(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};console.log("SpicyAccessibility initialization started");try{this.config={...g,...e},this.events=new o,console.log("EventBus initialized"),this.storage=new a(this.config.autoSave),console.log("Storage initialized"),this.settings=new n(this.storage,this.events),console.log("Settings initialized"),this.settings.load(),console.log("Settings loaded"),this.widget=new s(this.config,this.settings,this.events),console.log("Widget initialized"),this._registerFeatures(),console.log("Features registered"),this.widget.render(),console.log("Widget rendered"),"default"!==this.config.initialProfile&&(this.settings.loadProfile(this.config.initialProfile),console.log(`Applied initial profile: ${this.config.initialProfile}`)),console.log("SpicyAccessibility initialization completed"),setTimeout((()=>{if(!document.getElementById("spicy-access-btn")){console.warn("Accessibility button not found - creating emergency fallback");const e=document.createElement("button");e.id="emergency-a11y-btn",e.innerHTML='<span style="font-weight:bold;">A11Y</span>',e.style.cssText="\n            position: fixed !important;\n            bottom: 20px !important;\n            right: 20px !important;\n            z-index: 10000 !important;\n            width: auto !important;\n            min-width: 56px !important;\n            height: 56px !important;\n            padding: 0 15px !important;\n            background-color: #4361ee !important;\n            color: white !important;\n            border: none !important;\n            border-radius: 28px !important;\n            font-size: 16px !important;\n            box-shadow: 0 4px 16px rgba(0,0,0,0.2) !important;\n            display: flex !important;\n            align-items: center !important;\n            justify-content: center !important;\n            cursor: pointer !important;\n          ",document.body.appendChild(e),e.addEventListener("click",(()=>{this.widget&&"function"==typeof this.widget.togglePanel?this.widget.togglePanel():alert("Accessibility panel would open here, but there was an issue with the widget initialization.")}))}}),2e3)}catch(e){console.error("Error initializing SpicyAccessibility:",e)}return this},_registerFeatures(){try{const e=[new r(this.settings,this.events),new c(this.settings,this.events),new d(this.settings,this.events),new h(this.settings,this.events),new p(this.settings,this.events)];Array.isArray(this.config.features)&&"all"!==this.config.features&&e.forEach((e=>{e.enabledFeatures=e.features.filter((e=>this.config.features.includes(e.id)))})),e.forEach((e=>{this.widget.registerFeatureModule(e)}))}catch(e){console.error("Error registering features:",e)}},open(){this.widget.openPanel()},close(){this.widget.closePanel()},toggle(){this.widget.togglePanel()},applyProfile(e){this.settings.loadProfile(e)},enableFeature(e){this.settings.updateSetting(e,!0)},disableFeature(e){this.settings.updateSetting(e,!1)},reset(){this.settings.resetAll()},getSettings(){return this.settings.getAll()}};return t=t.default})()));