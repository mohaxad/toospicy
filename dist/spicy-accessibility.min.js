!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("SpicyAccessibility",[],t):"object"==typeof exports?exports.SpicyAccessibility=t():e.SpicyAccessibility=t()}(this,(()=>(()=>{"use strict";var e={d:(t,i)=>{for(var s in i)e.o(i,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:i[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=document.createElement(e);return t.id&&(i.id=t.id),t.className&&(Array.isArray(t.className)?i.classList.add(...t.className):i.className=t.className),t.attributes&&Object.entries(t.attributes).forEach((e=>{let[t,s]=e;i.setAttribute(t,s)})),t.properties&&Object.entries(t.properties).forEach((e=>{let[t,s]=e;i[t]=s})),t.dataset&&Object.entries(t.dataset).forEach((e=>{let[t,s]=e;i.dataset[t]=s})),t.style&&Object.entries(t.style).forEach((e=>{let[t,s]=e;i.style[t]=s})),void 0!==t.textContent&&(i.textContent=t.textContent),void 0!==t.innerHTML&&(i.innerHTML=t.innerHTML),t.children&&t.children.forEach((e=>{i.appendChild(e)})),i}e.d(t,{default:()=>h});class s{constructor(e,t,i){this.config=e||{},this.settings=t,this.events=i,this.featureModules=[],this.isOpen=!1,this._outsideClickHandler=null,this._justToggled=!1,this.togglePanel=this.togglePanel||function(){},this.handleKeydown=this.handleKeydown||function(){},this.openPanel=this.openPanel||function(){},this.closePanel=this.closePanel||function(){};const s=(e,t)=>"function"==typeof e?e.bind(t):function(){};this.togglePanel=s(this.togglePanel,this),this.handleKeydown=s(this.handleKeydown,this),this.openPanel=s(this.openPanel,this),this.closePanel=s(this.closePanel,this),this.events&&"function"==typeof this.events.on&&"function"==typeof this.updateUI&&this.events.on("settings:changed",this.updateUI.bind(this)),document.body?this.render().catch((e=>{console.error("Error initializing widget:",e)})):document.addEventListener("DOMContentLoaded",(()=>{this.render().catch((e=>{console.error("Error initializing widget:",e)}))}))}registerFeatureModule(e){this.featureModules.push(e)}async render(){console.log("Rendering widget...");try{await new Promise((e=>{if(console.log("Adding global styles..."),document.getElementById("spicy-global-styles"))return console.log("Global styles already added"),void e();if(document.querySelector('link[href*="font-awesome"]'))console.log("Font Awesome already loaded");else{console.log("Loading Font Awesome from CDN...");const e=document.createElement("link");e.rel="stylesheet",e.href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css",e.integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==",e.crossOrigin="anonymous",e.referrerPolicy="no-referrer",document.head.appendChild(e);const t=document.createElement("link");t.rel="stylesheet",t.href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/solid.min.css",t.integrity="sha512-yDUXOUWwbHH4ggxueDnC5vJv4tmfySpVdIcN1LksGZi8W8EVZv4uKGrQc0pVf66zS7LDhFJM7Zdeow1sw1/8Jw==",t.crossOrigin="anonymous",t.referrerPolicy="no-referrer",document.head.appendChild(t),console.log("Font Awesome CSS added to document head")}const t=document.createElement("style");t.textContent='\n      .fa-universal-access:before {\n        content: "♿";\n      }\n      .fa-xmark:before {\n        content: "✕";\n      }\n      .fa-arrows-rotate:before {\n        content: "↻";\n      }\n    ',document.head.appendChild(t);const i=document.createElement("style");i.id="spicy-global-styles",i.textContent='\n      .keyboard-focus {\n        outline: 3px solid #4265ED !important;\n        outline-offset: 2px !important;\n      }\n      \n      /* Feature icon styles */\n      #spicy-access-panel i[class*="fa-"],\n      #spicy-access-btn i[class*="fa-"] {\n        font-family: \'Font Awesome 6 Free\', \'FontAwesome\', sans-serif !important;\n        font-weight: 900 !important;\n        font-style: normal;\n        display: inline-block;\n      }\n      \n      /* Panel animation */\n      #spicy-access-panel {\n        transition: opacity 0.3s ease, transform 0.3s ease;\n      }\n      \n      /* Focus indicator styles */\n      body.spicy-focus-indicator *:focus {\n        outline: 4px solid #f00 !important;\n        outline-offset: 3px !important;\n        border-radius: 2px;\n      }\n      \n      /* Big cursor styles */\n      body.spicy-big-cursor {\n        cursor: url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><path d="M8.652,29.21l8.364-8.4L5.594,13.414c-1.1-0.718-1.399-2.204-0.678-3.312 c0.721-1.107,2.205-1.401,3.313-0.678l11.414,7.389l8.365-8.398c0.785-0.789,2.048-0.789,2.832,0 c0.783,0.783,0.783,2.05,0,2.833l-8.364,8.397l11.414,7.388c1.107,0.721,1.409,2.205,0.68,3.313 c-0.722,1.107-2.206,1.407-3.315,0.679L19.83,22.638l-8.363,8.396c-0.786,0.786-2.048,0.786-2.832,0 C7.852,31.258,7.852,29.994,8.652,29.21z" fill="black" stroke="white" stroke-width="1.5"/></svg>\') 15 15, auto !important;\n      }\n      \n      /* Tooltip styles */\n      body.spicy-tooltips [title]:not([title=""]):hover::after {\n        content: attr(title);\n        position: absolute;\n        background: #333;\n        color: #fff;\n        padding: 8px 12px;\n        border-radius: 6px;\n        font-size: 14px;\n        z-index: 10000;\n        white-space: normal;\n        max-width: 300px;\n        box-shadow: 0 2px 8px rgba(0,0,0,0.2);\n        left: 50%;\n        transform: translateX(-50%);\n        bottom: calc(100% + 10px);\n        pointer-events: none;\n        line-height: 1.5;\n      }\n    ',document.head.appendChild(i),console.log("Global styles added"),e()})),console.log("Global styles loaded"),this.createToggleButton(),console.log("Toggle button created"),this.createPanel(),console.log("Panel created"),document.addEventListener("keydown",this.handleKeydown),console.log("Keyboard event listener added"),this.featureModules&&this.featureModules.length>0?(this.featureModules.forEach((e=>{e&&"function"==typeof e.init&&e.init()})),console.log("Feature modules initialized:",this.featureModules.length)):console.warn("No feature modules found to initialize"),this.addFocusListeners(),console.log("Focus listeners added"),console.log("Widget rendering completed successfully")}catch(e){console.error("Error rendering widget:",e)}}initialize(){console.log("Manually initializing widget..."),this.featureModules=this.featureModules||[],this.isOpen=!1,this._outsideClickHandler=null,this._justToggled=!1,this.togglePanel=this.togglePanel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.openPanel=this.openPanel.bind(this),this.closePanel=this.closePanel.bind(this),this.events&&"function"==typeof this.events.on&&this.events.on("settings:changed",this.updateUI.bind(this)),this.render().catch((e=>{console.error("Error in manual initialization:",e)})),this.featureModules&&this.featureModules.length>0&&this.featureModules.forEach((e=>{if(e&&"function"==typeof e.init&&!e.initialized)try{e.init(),e.initialized=!0}catch(e){console.error("Error initializing module:",e)}})),console.log("Manual initialization complete")}createToggleButton(){console.log("Creating toggle button..."),this.toggleButton=document.createElement("button"),this.toggleButton.id="spicy-access-btn",this.toggleButton.setAttribute("aria-label","Open accessibility menu"),this.toggleButton.setAttribute("title","Accessibility Options (Alt+A)"),this.toggleButton.innerHTML='<i class="fa-solid fa-universal-access" aria-hidden="true"></i>',Object.assign(this.toggleButton.style,{position:"fixed",bottom:"20px",right:"20px",zIndex:"9999",width:"64px",height:"64px",borderRadius:"50%",backgroundColor:"#4265ED",color:"white",border:"none",fontSize:"28px",cursor:"pointer",boxShadow:"0 4px 20px rgba(66, 101, 237, 0.3), 0 0 0 2px rgba(255, 255, 255, 0.2)",display:"flex",alignItems:"center",justifyContent:"center",padding:"0",overflow:"hidden",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)"}),setTimeout((()=>{const e=this.toggleButton.querySelector("i");e?Object.assign(e.style,{fontFamily:"'Font Awesome 6 Free', 'FontAwesome', sans-serif",fontWeight:"900",fontSize:"28px",textShadow:"0 0 10px rgba(255, 255, 255, 0.4)"}):(this.toggleButton.textContent="A11Y",this.toggleButton.style.fontWeight="700",this.toggleButton.style.letterSpacing="0.5px",console.warn("Font Awesome icon not rendered, using text fallback"))}),100),this.applyButtonPosition(),this.toggleButton.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),console.log("Toggle button clicked, current state:",this.isOpen),e._fromAccessibilityToggle=!0,setTimeout((()=>{this.togglePanel()}),10)}),!0),this.toggleButton.addEventListener("mouseover",(()=>{this.toggleButton.style.backgroundColor="#3255DD",this.toggleButton.style.transform="scale(1.05)",this.toggleButton.style.boxShadow="0 6px 24px rgba(66, 101, 237, 0.5), 0 0 0 3px rgba(255, 255, 255, 0.3), 0 0 15px rgba(66, 101, 237, 0.5)"})),this.toggleButton.addEventListener("mouseout",(()=>{this.toggleButton.style.backgroundColor="#4265ED",this.toggleButton.style.transform="scale(1)",this.toggleButton.style.boxShadow="0 4px 20px rgba(66, 101, 237, 0.3), 0 0 0 2px rgba(255, 255, 255, 0.2)"})),document.body.appendChild(this.toggleButton),console.log("Toggle button added to DOM")}applyButtonPosition(){this.toggleButton.style.top="",this.toggleButton.style.bottom="",this.toggleButton.style.left="",this.toggleButton.style.right="";const e=this.config.position||"bottom-right";e.includes("top")?this.toggleButton.style.top="20px":this.toggleButton.style.bottom="20px",e.includes("left")?this.toggleButton.style.left="20px":this.toggleButton.style.right="20px"}createPanel(){console.log("Creating accessibility panel...");try{this.panel=document.createElement("div"),this.panel.id="spicy-access-panel",this.panel.setAttribute("aria-hidden","true"),this.panel.setAttribute("role","dialog"),this.panel.setAttribute("aria-labelledby","spicy-panel-title"),Object.assign(this.panel.style,{position:"fixed",bottom:"95px",right:"20px",zIndex:"9998",width:"420px",maxHeight:"80vh",backgroundColor:"white",borderRadius:"16px",boxShadow:"0 10px 40px rgba(0, 0, 0, 0.2), 0 0 0 1px rgba(66, 101, 237, 0.1)",border:"none",overflowY:"auto",display:"none",transition:"opacity 0.3s ease, transform 0.3s ease"});const e=document.createElement("div");e.className="spicy-panel-header",Object.assign(e.style,{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 22px",backgroundColor:"#20408E",backgroundImage:"linear-gradient(135deg, #3255DD, #20408E)",color:"white",borderRadius:"16px 16px 0 0"});const t=document.createElement("h2");t.id="spicy-panel-title",t.textContent="Accessibility Settings",Object.assign(t.style,{margin:"0",fontSize:"19px",fontWeight:"600",color:"white",letterSpacing:"0.3px"});const i=document.createElement("button");i.id="spicy-close-btn",i.setAttribute("aria-label","Close menu"),i.innerHTML='<i class="fa-solid fa-xmark"></i>',Object.assign(i.style,{background:"rgba(255, 255, 255, 0.2)",border:"none",fontSize:"18px",color:"white",cursor:"pointer",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",transition:"all 0.2s",backdropFilter:"blur(2px)"}),e.appendChild(t),e.appendChild(i),this.panelContent=document.createElement("div"),this.panelContent.className="spicy-panel-content",Object.assign(this.panelContent.style,{padding:"24px",maxHeight:"calc(80vh - 140px)",overflowY:"auto"});const s=document.createElement("div");s.className="spicy-panel-footer",Object.assign(s.style,{padding:"20px",backgroundColor:"#20408E",backgroundImage:"linear-gradient(135deg, #20408E, #3255DD)",borderRadius:"0 0 16px 16px",textAlign:"center",color:"white"});const n=document.createElement("button");n.id="spicy-reset-all",n.innerHTML='<i class="fa-solid fa-arrows-rotate"></i> Reset All Accessibility Settings',Object.assign(n.style,{width:"100%",padding:"14px",fontSize:"16px",backgroundColor:"rgba(255, 255, 255, 0.15)",color:"white",border:"none",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",fontWeight:"500",cursor:"pointer",transition:"all 0.2s",backdropFilter:"blur(2px)"}),n.addEventListener("mouseover",(()=>{n.style.backgroundColor="rgba(255, 255, 255, 0.25)",n.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)"})),n.addEventListener("mouseout",(()=>{n.style.backgroundColor="rgba(255, 255, 255, 0.15)",n.style.boxShadow="none"}));const o=document.createElement("p");o.className="spicy-branding",o.innerHTML='<span aria-hidden="true">🍩</span> Powered by SpicyDonut',Object.assign(o.style,{marginTop:"14px",fontSize:"14px",color:"rgba(255, 255, 255, 0.7)"}),s.appendChild(n),s.appendChild(o),this.panel.appendChild(e),this.panel.appendChild(this.panelContent),this.panel.appendChild(s),i.addEventListener("click",(e=>{e.stopPropagation(),console.log("Close button clicked"),this.togglePanel(!1)})),i.addEventListener("mouseover",(()=>{i.style.backgroundColor="rgba(255, 255, 255, 0.3)",i.style.transform="scale(1.05)"})),i.addEventListener("mouseout",(()=>{i.style.backgroundColor="rgba(255, 255, 255, 0.2)",i.style.transform="scale(1)"})),n.addEventListener("click",(e=>{e.stopPropagation(),console.log("Reset button clicked"),this.resetAllSettings()})),this.populatePanel(),document.body.appendChild(this.panel),console.log("Panel added to DOM")}catch(e){console.error("Error creating panel:",e)}}populatePanel(){console.log("Populating panel with feature modules...");try{if(!this.panelContent)return void console.error("Panel content container not found");if(this.panelContent.innerHTML="",!this.featureModules)return console.warn("No feature modules array available"),void(this.panelContent.innerHTML='<p style="text-align:center;padding:20px;">No accessibility features available.</p>');const e=this.featureModules.filter((e=>e&&"object"==typeof e&&e.features&&Array.isArray(e.features)&&e.features.length>0));if(console.log(`Found ${e.length} valid feature modules out of ${this.featureModules.length} total`),0===e.length)return console.warn("No valid feature modules available to populate panel"),void(this.panelContent.innerHTML='<p style="text-align:center;padding:20px;">No accessibility features available.</p>');e.forEach(((e,t)=>{const i=e.constructor?e.constructor.name.replace("Features",""):`Feature Group ${t+1}`,s=this.getSectionIcon(i);console.log(`Creating section for ${i} with ${e.features.length} features`);const n=document.createElement("div");n.className="spicy-section",Object.assign(n.style,{marginBottom:"24px",paddingBottom:"20px",borderBottom:"1px solid #f0f0f0"});const o=document.createElement("h3");o.innerHTML=`<i class="${s}"></i> ${i}`,Object.assign(o.style,{fontSize:"16px",color:"#4265ED",marginBottom:"16px",fontWeight:"600",display:"flex",alignItems:"center",paddingBottom:"8px",borderBottom:"1px solid #eee"});const a=o.querySelector("i");a&&(a.style.marginRight="10px",Object.assign(a.style,{fontFamily:"'Font Awesome 6 Free', 'FontAwesome', sans-serif",fontWeight:"900",marginRight:"10px"})),n.appendChild(o);const r=document.createElement("div");r.className="spicy-grid",Object.assign(r.style,{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"12px",marginTop:"16px"});const l=Array.isArray(e.enabledFeatures)?e.enabledFeatures:e.features;if(0!==l.length){if("Text"===i&&l.some((e=>"fontSize"===e.id))){const t=l.find((e=>"fontSize"===e.id));if(t){const i=this.createFontSizeControl(t,e.settings);n.appendChild(i)}}l.forEach((t=>{if("fontSize"!==t.id||"Text"!==i)try{const i=this.createFeatureButton(t,e.settings);r.appendChild(i)}catch(e){console.error(`Error creating button for feature ${t.id}:`,e)}})),r.children.length>0&&(n.appendChild(r),this.panelContent.appendChild(n))}else console.warn(`No enabled features for ${i}`)}));try{const e=document.createElement("div");e.className="spicy-section",Object.assign(e.style,{marginBottom:"0",paddingBottom:"0",borderBottom:"none"});const t=document.createElement("h3");t.innerHTML='<i class="fa-solid fa-arrows-up-down-left-right"></i> Widget Position',Object.assign(t.style,{fontSize:"16px",color:"#4265ED",marginBottom:"16px",fontWeight:"600",display:"flex",alignItems:"center",paddingBottom:"8px",borderBottom:"1px solid #eee"});const i=t.querySelector("i");i&&Object.assign(i.style,{fontFamily:"'Font Awesome 6 Free', 'FontAwesome', sans-serif",fontWeight:"900",marginRight:"10px"}),e.appendChild(t);const s=document.createElement("div");s.className="spicy-grid",Object.assign(s.style,{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"12px",marginTop:"16px"});[{id:"bottomRight",name:"Bottom Right",icon:"fa-solid fa-arrow-down-right"},{id:"bottomLeft",name:"Bottom Left",icon:"fa-solid fa-arrow-down-left"}].forEach((e=>{const t=this.createFeatureButton(e,{getSetting:()=>this.config&&this.config.position===e.id,updateSetting:()=>this.moveWidget(e.id)});s.appendChild(t)})),e.appendChild(s),this.panelContent.appendChild(e)}catch(e){console.error("Error adding move widget section:",e)}this.enforceIconStyles(),console.log("Panel populated successfully")}catch(e){console.error("Error populating panel:",e);try{this.panelContent.innerHTML='\n          <div style="padding: 20px; text-align: center;">\n            <h3 style="margin-bottom: 16px; color: #4265ED;">Accessibility Features</h3>\n            <p>There was an error loading the accessibility features.</p>\n            <button id="spicy-emergency-reset" style="margin-top: 16px; padding: 10px 16px; background: #4265ED; color: white; border: none; border-radius: 8px; cursor: pointer;">\n              Reset All Settings\n            </button>\n          </div>\n        ';const e=document.getElementById("spicy-emergency-reset");e&&this.settings&&"function"==typeof this.settings.resetAll&&e.addEventListener("click",(()=>this.settings.resetAll()))}catch(e){console.error("Emergency panel content failed:",e)}}}createFeatureButton(e,t){try{console.log(`Creating button for feature: ${e.id}`);const i=document.createElement("button");i.className="spicy-feature-btn",i.id=`spicy-${e.id}`;let s=`<i class="${e.icon||"fa-solid fa-circle"}"></i><span>${e.name}</span>`;(e.levels||"slider"===e.type||"level"===e.type)&&(s+='<div class="spicy-level-indicator"></div>'),i.innerHTML=s,Object.assign(i.style,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"22px 10px",backgroundColor:"white",border:"1px solid #e9ecef",borderRadius:"14px",cursor:"pointer",transition:"all 0.25s cubic-bezier(0.4, 0, 0.2, 1)",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.04)",position:"relative",height:"100px",overflow:"hidden"});const n=i.querySelector("i");n&&Object.assign(n.style,{fontSize:"28px",marginBottom:"12px",color:"#4265ED",fontFamily:"'Font Awesome 6 Free', 'FontAwesome', sans-serif",fontWeight:"900",transition:"transform 0.3s ease"});const o=i.querySelector("span");o&&Object.assign(o.style,{fontSize:"13px",color:"#222",textAlign:"center",fontWeight:"600"});const a=i.querySelector(".spicy-level-indicator");a&&Object.assign(a.style,{position:"absolute",bottom:"0",left:"0",width:"0%",height:"4px",backgroundColor:"#4265ED",transition:"width 0.3s ease",borderRadius:"0 4px 4px 0"});let r=!1,l=0;if(t&&"function"==typeof t.getSetting){const s=t.getSetting(e.id);if(r=Boolean(s),a&&"number"==typeof s){l=s;const t=l/(e.max||100)*100;a.style.width=`${t}%`}if(r){i.classList.add("active");const e=document.createElement("div");e.className="spicy-checkmark",e.innerHTML="✓",Object.assign(e.style,{position:"absolute",top:"10px",right:"10px",background:"#4265ED",color:"white",width:"22px",height:"22px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:"bold",boxShadow:"0 2px 6px rgba(66, 101, 237, 0.3)",zIndex:"2"}),i.appendChild(e),i.style.backgroundColor="#e7f5ff",i.style.borderColor="#4265ED",i.style.boxShadow="0 2px 12px rgba(67, 97, 238, 0.15)"}}return i.addEventListener("click",(()=>{if(r=!r,r){if(i.classList.add("active"),i.style.backgroundColor="#e7f5ff",i.style.borderColor="#4265ED",i.style.boxShadow="0 2px 12px rgba(67, 97, 238, 0.15)",n&&(n.style.transform="scale(1.1)",setTimeout((()=>{n.style.transform="scale(1)"}),300)),!i.querySelector(".spicy-checkmark")){const e=document.createElement("div");e.className="spicy-checkmark",e.innerHTML="✓",Object.assign(e.style,{position:"absolute",top:"10px",right:"10px",background:"#4265ED",color:"white",width:"22px",height:"22px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:"bold",boxShadow:"0 2px 6px rgba(66, 101, 237, 0.3)",zIndex:"2",transform:"scale(0)",transition:"transform 0.2s ease"}),i.appendChild(e),setTimeout((()=>{e.style.transform="scale(1)"}),10)}}else{i.classList.remove("active"),i.style.backgroundColor="white",i.style.borderColor="#e9ecef",i.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.04)",n&&(n.style.transform="scale(0.9)",setTimeout((()=>{n.style.transform="scale(1)"}),300));const e=i.querySelector(".spicy-checkmark");e&&(e.style.transform="scale(0)",setTimeout((()=>{e.parentNode===i&&i.removeChild(e)}),200))}t&&"function"==typeof t.updateSetting&&t.updateSetting(e.id,r)})),i.addEventListener("mouseover",(()=>{i.style.transform="translateY(-3px)",i.style.boxShadow=r?"0 6px 16px rgba(67, 97, 238, 0.2)":"0 6px 12px rgba(0, 0, 0, 0.08)",n&&(n.style.transform="scale(1.05)")})),i.addEventListener("mouseout",(()=>{i.style.transform="translateY(0)",i.style.boxShadow=r?"0 2px 12px rgba(67, 97, 238, 0.15)":"0 2px 8px rgba(0, 0, 0, 0.04)",n&&(n.style.transform="scale(1)")})),this.addFeatureInfo(i,e.id),i}catch(t){console.error(`Error creating button for feature ${e.id}:`,t);const i=document.createElement("button");return i.textContent=e.name||"Feature",i.style.padding="10px",i.style.border="1px solid #ccc",i.style.borderRadius="5px",i}}createFontSizeControl(e,t){try{const i=document.createElement("div");i.className="spicy-control-group",Object.assign(i.style,{display:"flex",alignItems:"center",gap:"15px",marginBottom:"24px",padding:"16px",backgroundColor:"#f8fafc",borderRadius:"14px",boxShadow:"inset 0 1px 3px rgba(0, 0, 0, 0.05)",border:"1px solid rgba(66, 101, 237, 0.1)"});const s=document.createElement("button");s.innerHTML='<i class="fa-solid fa-minus"></i>',s.setAttribute("aria-label","Decrease font size"),Object.assign(s.style,{width:"38px",height:"38px",borderRadius:"50%",border:"none",backgroundColor:"white",color:"#4265ED",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 2px 6px rgba(0, 0, 0, 0.1)",transition:"all 0.2s ease",fontSize:"16px"});const n=document.createElement("div");n.className="spicy-slider-container",Object.assign(n.style,{flexGrow:"1",display:"flex",flexDirection:"column",alignItems:"center"});const o=document.createElement("input");o.type="range",o.id="spicy-font-slider",o.min=e.min||80,o.max=e.max||200,o.step=e.step||10,Object.assign(o.style,{width:"100%",height:"6px",appearance:"none",backgroundColor:"#e9ecef",borderRadius:"3px",outline:"none",cursor:"pointer"});const a="\n        #spicy-font-slider::-webkit-slider-thumb {\n          -webkit-appearance: none;\n          appearance: none;\n          width: 18px;\n          height: 18px;\n          border-radius: 50%;\n          background: #4265ED;\n          box-shadow: 0 2px 5px rgba(66, 101, 237, 0.3);\n          cursor: pointer;\n          transition: all 0.2s ease;\n        }\n        #spicy-font-slider::-webkit-slider-thumb:hover {\n          transform: scale(1.1);\n          box-shadow: 0 2px 8px rgba(66, 101, 237, 0.5);\n        }\n        #spicy-font-slider::-moz-range-thumb {\n          width: 18px;\n          height: 18px;\n          border: none;\n          border-radius: 50%;\n          background: #4265ED;\n          box-shadow: 0 2px 5px rgba(66, 101, 237, 0.3);\n          cursor: pointer;\n          transition: all 0.2s ease;\n        }\n        #spicy-font-slider::-moz-range-thumb:hover {\n          transform: scale(1.1);\n        }\n        #spicy-font-slider::-ms-thumb {\n          width: 18px;\n          height: 18px;\n          border-radius: 50%;\n          background: #4265ED;\n          box-shadow: 0 2px 5px rgba(66, 101, 237, 0.3);\n          cursor: pointer;\n          transition: all 0.2s ease;\n        }\n      ",r=document.createElement("style");r.textContent=a,document.head.appendChild(r);const l=document.createElement("div");l.style.width="100%",l.style.display="flex",l.style.justifyContent="space-between",l.style.marginTop="10px";const c=document.createElement("div");c.id="spicy-font-size-label",c.textContent="100%",Object.assign(c.style,{fontSize:"14px",color:"#4265ED",fontWeight:"600",padding:"2px 8px",backgroundColor:"rgba(66, 101, 237, 0.1)",borderRadius:"4px"});const d=document.createElement("div");d.className="spicy-level-indicators",Object.assign(d.style,{display:"flex",gap:"3px"});[80,100,130,160,200].forEach((e=>{const t=document.createElement("div");Object.assign(t.style,{width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"#cdd5e0",transition:"all 0.2s ease"}),t.dataset.level=e,d.appendChild(t)})),l.appendChild(c),l.appendChild(d);const p=document.createElement("button");if(p.innerHTML='<i class="fa-solid fa-plus"></i>',p.setAttribute("aria-label","Increase font size"),Object.assign(p.style,{width:"38px",height:"38px",borderRadius:"50%",border:"none",backgroundColor:"white",color:"#4265ED",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 2px 6px rgba(0, 0, 0, 0.1)",transition:"all 0.2s ease",fontSize:"16px"}),[s,p].forEach((e=>{e.addEventListener("mouseover",(()=>{e.style.backgroundColor="#f0f7ff",e.style.transform="scale(1.05)",e.style.boxShadow="0 3px 10px rgba(66, 101, 237, 0.2)"})),e.addEventListener("mouseout",(()=>{e.style.backgroundColor="white",e.style.transform="scale(1)",e.style.boxShadow="0 2px 6px rgba(0, 0, 0, 0.1)"}))})),t&&"function"==typeof t.getSetting){const u=t.getSetting(e.id)||100;o.value=u,c.textContent=`${u}%`,g(u)}function g(e){d.querySelectorAll("div").forEach((t=>{const i=parseInt(t.dataset.level);e>=i?(t.style.backgroundColor="#4265ED",t.style.transform="scale(1.2)"):(t.style.backgroundColor="#cdd5e0",t.style.transform="scale(1)")}))}return o.addEventListener("input",(()=>{const i=parseInt(o.value);c.textContent=`${i}%`,g(i),t&&"function"==typeof t.updateSetting&&t.updateSetting(e.id,i)})),s.addEventListener("click",(()=>{const i=parseInt(o.value),n=parseInt(e.step)||10,a=Math.max(parseInt(e.min)||80,i-n);o.value=a,c.textContent=`${a}%`,g(a),s.style.transform="scale(0.9)",setTimeout((()=>{s.style.transform="scale(1)"}),150),t&&"function"==typeof t.updateSetting&&t.updateSetting(e.id,a)})),p.addEventListener("click",(()=>{const i=parseInt(o.value),s=parseInt(e.step)||10,n=Math.min(parseInt(e.max)||200,i+s);o.value=n,c.textContent=`${n}%`,g(n),p.style.transform="scale(0.9)",setTimeout((()=>{p.style.transform="scale(1)"}),150),t&&"function"==typeof t.updateSetting&&t.updateSetting(e.id,n)})),n.appendChild(o),n.appendChild(l),i.appendChild(s),i.appendChild(n),i.appendChild(p),i}catch(h){console.error("Error creating font size control:",h);const f=document.createElement("div");return f.textContent="Font Size Control",f.style.padding="10px",f.style.border="1px solid #ccc",f.style.borderRadius="5px",f.style.marginBottom="15px",f}}resetAllSettings(){console.log("Resetting all settings..."),this.settings&&"function"==typeof this.settings.resetAll?this.settings.resetAll():this.featureModules&&this.featureModules.length>0?this.featureModules.forEach((e=>{e&&"function"==typeof e.reset&&e.reset()})):console.warn("No feature modules found to reset"),console.log("All settings reset")}addFocusListeners(){try{let e=!1;if(document.addEventListener("keydown",(t=>{"Tab"===t.key&&(e=!0,document.body.classList.add("keyboard-focus"))})),document.addEventListener("mousedown",(()=>{e=!1,document.body.classList.remove("keyboard-focus")})),this.panel){this.panel.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])').forEach((t=>{t.addEventListener("focus",(()=>{e&&t.classList.add("keyboard-focus")})),t.addEventListener("blur",(()=>{t.classList.remove("keyboard-focus")}))}))}this.toggleButton&&(this.toggleButton.addEventListener("focus",(()=>{e&&this.toggleButton.classList.add("keyboard-focus")})),this.toggleButton.addEventListener("blur",(()=>{this.toggleButton.classList.remove("keyboard-focus")}))),console.log("Focus listeners added for keyboard navigation")}catch(e){console.error("Error adding focus listeners:",e)}}getSectionIcon(e){let t="fa-solid fa-sliders";const i={Text:"fa-solid fa-font",Visual:"fa-solid fa-eye",Display:"fa-solid fa-display",Navigation:"fa-solid fa-location-arrow",Content:"fa-solid fa-file-lines",Audio:"fa-solid fa-volume-high",Media:"fa-solid fa-photo-film",Advanced:"fa-solid fa-gears",Profiles:"fa-solid fa-users"};return e&&i[e]&&(t=i[e]),t}addFeatureInfo(e,t){const i={fontSize:"Adjust the text size on the page for better readability",lineHeight:"Increase the space between lines of text",letterSpacing:"Adjust the space between letters for easier reading",dyslexiaFont:"Use a font designed to be more readable for people with dyslexia",contrast:"Increase contrast between text and background",darkMode:"Switch to dark theme for reduced eye strain",lightMode:"Switch to light theme",grayscale:"Convert all colors to grayscale",invertColors:"Invert all colors on the page",readingGuide:"Show a horizontal guide that follows your cursor to help focus on text",focusMode:"Highlight the element you are currently focused on",highlightLinks:"Make all links on the page more visible",bigCursor:"Use a larger cursor that is easier to see",stopAnimations:"Pause all animations on the page",hideImages:"Hide all images for distraction-free reading",textToSpeech:"Read selected text aloud",volumeControl:"Adjust the volume of the screen reader"};if(i[t]){e.setAttribute("title",i[t]),e.setAttribute("aria-label",`${e.textContent.trim()} - ${i[t]}`);const s=document.createElement("span");s.className="spicy-info-icon",s.innerHTML="ⓘ",Object.assign(s.style,{position:"absolute",top:"10px",left:"10px",fontSize:"12px",color:"rgba(66, 101, 237, 0.7)",fontWeight:"bold"}),e.appendChild(s)}}moveWidget(e){try{if(!this.toggleButton)return;this.config.position=e,this.applyButtonPosition(),this.isOpen&&this.panel&&(e.includes("left")?(this.panel.style.left="20px",this.panel.style.right="auto"):(this.panel.style.right="20px",this.panel.style.left="auto"),e.includes("top")?(this.panel.style.top="95px",this.panel.style.bottom="auto"):(this.panel.style.bottom="95px",this.panel.style.top="auto")),console.log(`Widget moved to ${e}`);const t=document.getElementById("spicy-bottomRight"),i=document.getElementById("spicy-bottomLeft");t&&t.classList.toggle("active","bottomRight"===e),i&&i.classList.toggle("active","bottomLeft"===e)}catch(e){console.error("Error moving widget:",e)}}updateUI(e){if(this.panel&&e)try{this.featureModules&&this.featureModules.forEach((t=>{t&&t.features&&Array.isArray(t.features)&&t.features.forEach((t=>{const i=document.getElementById(`spicy-${t.id}`);if(i){const s=e[t.id];if(i.classList.toggle("active",s),s){if(i.style.backgroundColor="#e7f5ff",i.style.borderColor="#4265ED",i.style.boxShadow="0 2px 12px rgba(67, 97, 238, 0.15)",!i.querySelector(".spicy-checkmark")){const e=document.createElement("div");e.className="spicy-checkmark",e.innerHTML="✓",Object.assign(e.style,{position:"absolute",top:"10px",right:"10px",background:"#4265ED",color:"white",width:"22px",height:"22px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:"bold",boxShadow:"0 2px 6px rgba(66, 101, 237, 0.3)",zIndex:"2"}),i.appendChild(e)}}else{i.style.backgroundColor="white",i.style.borderColor="#e9ecef",i.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.04)";const e=i.querySelector(".spicy-checkmark");e&&i.removeChild(e)}}}))}))}catch(e){console.error("Error updating UI:",e)}}togglePanel(e){if(console.log("Toggling panel, current state:",this.isOpen),this._justToggled)console.log("Ignoring toggle: panel was just toggled");else{this._justToggled=!0,setTimeout((()=>{this._justToggled=!1}),500);try{if(!this.panel&&(console.error("Panel element not found!"),this.createPanel(),!this.panel))throw new Error("Failed to create accessibility panel");const t=window.event,i=t?t.target:null,s=void 0!==e?e:!this.isOpen;if(this.isOpen=s,this.toggleButton&&(this.isOpen?(this.toggleButton.setAttribute("aria-expanded","true"),this.toggleButton.setAttribute("aria-label","Close accessibility menu")):(this.toggleButton.setAttribute("aria-expanded","false"),this.toggleButton.setAttribute("aria-label","Open accessibility menu"))),this.isOpen){if(this.config&&this.config.position){const e=this.config.position;e.includes("left")?(this.panel.style.left="20px",this.panel.style.right="auto"):(this.panel.style.right="20px",this.panel.style.left="auto"),e.includes("top")?(this.panel.style.top="95px",this.panel.style.bottom="auto"):(this.panel.style.bottom="95px",this.panel.style.top="auto")}else this.panel.style.right="20px",this.panel.style.bottom="95px",this.panel.style.left="auto",this.panel.style.top="auto";this.panel.style.display="block",this.panel.offsetHeight,this.panel.style.opacity="1",this.panel.style.transform="translateY(0)",this.panel.setAttribute("aria-hidden","false"),this.populatePanel(),this._outsideClickHandler&&(document.removeEventListener("click",this._outsideClickHandler),this._outsideClickHandler=null),setTimeout((()=>{this.isOpen&&(this._outsideClickHandler=e=>{e&&e.target&&this.toggleButton&&this.panel&&(this.toggleButton.contains(e.target)||this.panel.contains(e.target)||(i!==e.target?(console.log("Outside click detected, closing panel"),this.togglePanel(!1)):console.log("Skipping same click that opened panel")))},document.addEventListener("click",this._outsideClickHandler))}),600)}else this.panel.style.opacity="0",this.panel.style.transform="translateY(20px)",this.panel.setAttribute("aria-hidden","true"),this._outsideClickHandler&&(document.removeEventListener("click",this._outsideClickHandler),this._outsideClickHandler=null),setTimeout((()=>{!this.isOpen&&this.panel&&(this.panel.style.display="none")}),300);console.log("Panel toggled, new state:",this.isOpen)}catch(e){console.error("Error toggling panel:",e),this.isOpen=!1,this.panel&&(this.panel.style.display="none")}}}openPanel(){this.togglePanel(!0)}closePanel(){this.togglePanel(!1)}handleKeydown(e){e.altKey&&"a"===e.key&&(e.preventDefault(),this.togglePanel()),"Escape"===e.key&&this.isOpen&&(e.preventDefault(),this.togglePanel(!1))}enforceIconStyles(){try{if(!this.panel)return;const e=this.panel.querySelectorAll('i[class*="fa-"]');e.forEach((e=>{Object.assign(e.style,{fontFamily:"'Font Awesome 6 Free', 'FontAwesome', sans-serif",fontWeight:"900",fontStyle:"normal",display:"inline-block",textRendering:"auto",lineHeight:"1"})})),console.log(`Applied consistent styling to ${e.length} icons`)}catch(e){console.error("Error enforcing icon styles:",e)}}}class n{constructor(e,t){this.storage=e,this.events=t,this.settings={},this.profiles={},this.defaultSettings={fontSize:100,lineHeight:!1,letterSpacing:!1,dyslexicFont:!1,contrast:!1,darkMode:!1,lightMode:!1,grayscale:!1,highlightLinks:!1,readingGuide:!1,hideImages:!1,pauseAnimations:!1,bigCursor:!1,focusIndicator:!1,pageStructure:!1,textToSpeech:!1,tooltips:!1}}load(){const e=this.storage.getItem("spicySettings");this.settings=e?JSON.parse(e):{...this.defaultSettings};const t=this.storage.getItem("spicyProfiles");this.profiles=t?JSON.parse(t):this.getDefaultProfiles(),this.events.emit("settings:loaded",this.settings)}getDefaultProfiles(){return{default:{...this.defaultSettings},highContrast:{...this.defaultSettings,contrast:!0,highlightLinks:!0,focusIndicator:!0},dyslexic:{...this.defaultSettings,dyslexicFont:!0,lineHeight:!0,letterSpacing:!0,fontSize:120},senior:{...this.defaultSettings,fontSize:150,highlightLinks:!0,bigCursor:!0,focusIndicator:!0},lowVision:{...this.defaultSettings,fontSize:175,contrast:!0,highlightLinks:!0,bigCursor:!0},motor:{...this.defaultSettings,bigCursor:!0,focusIndicator:!0,pauseAnimations:!0},cognitive:{...this.defaultSettings,readingGuide:!0,pauseAnimations:!0,lineHeight:!0}}}save(){this.storage.setItem("spicySettings",JSON.stringify(this.settings)),this.events.emit("settings:saved",this.settings)}updateSetting(e,t){this.settings[e]=t,this.save(),this.events.emit("settings:changed",this.settings,{key:e,value:t})}updateSettings(e){Object.assign(this.settings,e),this.save(),this.events.emit("settings:changed",this.settings,{updates:e})}getSetting(e){return this.settings[e]}getAll(){return{...this.settings}}resetAll(){this.settings={...this.defaultSettings},this.save(),this.events.emit("settings:reset",this.settings)}loadProfile(e){this.profiles[e]?(this.settings={...this.profiles[e]},this.save(),this.events.emit("settings:profile:loaded",e,this.settings)):console.warn(`Profile "${e}" not found`)}saveProfile(e){return"default"===e?(console.warn("Cannot overwrite the default profile"),!1):(this.profiles[e]={...this.settings},this.storage.setItem("spicyProfiles",JSON.stringify(this.profiles)),this.events.emit("settings:profile:saved",e,this.settings),!0)}deleteProfile(e){return["default","highContrast","dyslexic","senior","lowVision","motor","cognitive"].includes(e)?(console.warn(`Cannot delete built-in profile "${e}"`),!1):!!this.profiles[e]&&(delete this.profiles[e],this.storage.setItem("spicyProfiles",JSON.stringify(this.profiles)),this.events.emit("settings:profile:deleted",e),!0)}getProfiles(){return{...this.profiles}}}class o{constructor(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.prefix="spicy-",this.autoSave=e,this.isAvailable=this.checkAvailability()}checkAvailability(){try{const e=`${this.prefix}test`;return localStorage.setItem(e,"test"),localStorage.removeItem(e),!0}catch(e){return console.warn("Local storage is not available:",e),!1}}getItem(e){if(!this.isAvailable)return null;try{return localStorage.getItem(`${this.prefix}${e}`)}catch(t){return console.error(`Error retrieving ${e} from storage:`,t),null}}setItem(e,t){if(!this.isAvailable||!this.autoSave)return!1;try{return localStorage.setItem(`${this.prefix}${e}`,t),!0}catch(t){return console.error(`Error saving ${e} to storage:`,t),!1}}removeItem(e){if(!this.isAvailable)return!1;try{return localStorage.removeItem(`${this.prefix}${e}`),!0}catch(t){return console.error(`Error removing ${e} from storage:`,t),!1}}clear(){if(!this.isAvailable)return!1;try{return Object.keys(localStorage).forEach((e=>{e.startsWith(this.prefix)&&localStorage.removeItem(e)})),!0}catch(e){return console.error("Error clearing storage:",e),!1}}}class a{constructor(){this.listeners=new Map}on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set);const i=this.listeners.get(e);return i.add(t),()=>{i.delete(t),0===i.size&&this.listeners.delete(e)}}once(e,t){const i=this.on(e,(function(){i(),t(...arguments)}));return i}off(e,t){const i=this.listeners.get(e);if(!i)return!1;const s=i.delete(t);return 0===i.size&&this.listeners.delete(e),s}emit(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];const n=this.listeners.get(e);n&&n.forEach((t=>{try{t(...i)}catch(t){console.error(`Error in event handler for ${e}:`,t)}}));const o=this.listeners.get("*");o&&o.forEach((t=>{try{t(e,...i)}catch(t){console.error(`Error in wildcard event handler for ${e}:`,t)}}))}clear(e){e?this.listeners.delete(e):this.listeners.clear()}listenerCount(e){const t=this.listeners.get(e);return t?t.size:0}}const r=new Set;class l{constructor(e,t){this.settings=e,this.events=t,this.features=[{id:"fontSize",name:"Text Size",icon:"fa-solid fa-text-height",type:"slider",min:80,max:200,step:10,default:100},{id:"dyslexicFont",name:"Dyslexia Font",icon:"fa-solid fa-font",type:"toggle"},{id:"lineHeight",name:"Line Spacing",icon:"fa-solid fa-arrows-up-down",type:"toggle"},{id:"letterSpacing",name:"Letter Spacing",icon:"fa-solid fa-arrows-left-right",type:"toggle"}],this.enabledFeatures=[...this.features]}init(){!function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=`${e}-${t}`;if(r.has(s))return Promise.resolve();const{fontStyle:n="normal",fontWeight:o="normal",fontDisplay:a="swap"}=i,l=`\n    @font-face {\n      font-family: '${e}';\n      src: url('${t}') format('woff2'),\n           url('${t}') format('woff');\n      font-style: ${n};\n      font-weight: ${o};\n      font-display: ${a};\n    }\n  `,c=document.createElement("style");if(c.textContent=l,document.head.appendChild(c),"FontFace"in window)return new FontFace(e,`url(${t})`,{style:n,weight:o,display:a}).load().then((e=>{document.fonts.add(e),r.add(s)})).catch((t=>{console.error(`Error loading font ${e}:`,t)}));new Promise((t=>{const i=document.createElement("span");i.style.fontFamily=`'${e}', monospace`,i.style.fontSize="0",i.style.visibility="hidden",i.textContent="Font loaded test",document.body.appendChild(i),setTimeout((()=>{document.body.removeChild(i),r.add(s),t()}),50)}))}("OpenDyslexic","https://cdn.jsdelivr.net/npm/open-dyslexic@1.0.3/open-dyslexic-regular.woff"),this.applySettings(this.settings.getAll()),this.events.on("settings:changed",this.applySettings.bind(this))}applySettings(e){document.documentElement.style.setProperty("--spicy-font-size",`${e.fontSize}%`),document.body.classList.toggle("spicy-dyslexic",e.dyslexicFont),document.body.classList.toggle("spicy-line-height",e.lineHeight),document.body.classList.toggle("spicy-letter-spacing",e.letterSpacing)}renderSection(){if(0===this.enabledFeatures.length)return null;const e=i("div",{className:"spicy-section",innerHTML:'<h3><i class="fa-solid fa-book-open-reader"></i> Text & Reading</h3>'}),t=this.enabledFeatures.find((e=>"fontSize"===e.id));if(t){const i=this.createFontSizeControl(t);e.appendChild(i)}const s=i("div",{className:"spicy-grid"});return this.enabledFeatures.filter((e=>"toggle"===e.type)).forEach((e=>{const t=this.createFeatureButton(e);s.appendChild(t)})),s.children.length>0&&e.appendChild(s),e}createFontSizeControl(e){const t=i("div",{className:"spicy-control-group"}),s=i("button",{className:"spicy-btn spicy-icon-btn",id:"spicy-font-decrease",innerHTML:'<i class="fa-solid fa-minus"></i>',attributes:{"aria-label":"Decrease font size"}}),n=i("div",{className:"spicy-slider-container"}),o=i("input",{id:"spicy-font-slider",attributes:{type:"range",min:e.min,max:e.max,step:e.step,value:this.settings.getSetting("fontSize"),"aria-labelledby":"spicy-font-size-label"}}),a=i("span",{id:"spicy-font-size-label",textContent:`${this.settings.getSetting("fontSize")}%`}),r=i("button",{className:"spicy-btn spicy-icon-btn",id:"spicy-font-increase",innerHTML:'<i class="fa-solid fa-plus"></i>',attributes:{"aria-label":"Increase font size"}});return n.appendChild(o),n.appendChild(a),t.appendChild(s),t.appendChild(n),t.appendChild(r),o.addEventListener("input",(()=>{const e=o.value;this.settings.updateSetting("fontSize",parseInt(e)),a.textContent=`${e}%`})),s.addEventListener("click",(()=>{const t=Math.max(e.min,parseInt(o.value)-e.step);o.value=t,this.settings.updateSetting("fontSize",t),a.textContent=`${t}%`})),r.addEventListener("click",(()=>{const t=Math.min(e.max,parseInt(o.value)+e.step);o.value=t,this.settings.updateSetting("fontSize",t),a.textContent=`${t}%`})),t}createFeatureButton(e){const t=i("button",{className:"spicy-feature-btn",id:`spicy-${e.id}`,innerHTML:`\n        <i class="${e.icon}"></i>\n        <span>${e.name}</span>\n      `});return this.settings.getSetting(e.id)&&t.classList.add("active"),t.addEventListener("click",(()=>{const i=t.classList.toggle("active");this.settings.updateSetting(e.id,i)})),t}updateUI(e){const t=document.getElementById("spicy-font-slider"),i=document.getElementById("spicy-font-size-label");t&&i&&(t.value=e.fontSize,i.textContent=`${e.fontSize}%`),this.features.filter((e=>"toggle"===e.type)).forEach((t=>{const i=document.getElementById(`spicy-${t.id}`);i&&i.classList.toggle("active",e[t.id])}))}}class c{constructor(e,t){this.settings=e,this.events=t,this.features=[{id:"contrast",name:"High Contrast",icon:"fa-solid fa-adjust",type:"toggle"},{id:"smartContrast",name:"Smart Contrast",icon:"fa-solid fa-circle-half-stroke",type:"toggle"},{id:"contrastBlue",name:"Blue Contrast",icon:"fa-solid fa-droplet",type:"toggle"},{id:"darkMode",name:"Dark Mode",icon:"fa-solid fa-moon",type:"toggle"},{id:"lightMode",name:"Light Mode",icon:"fa-solid fa-sun",type:"toggle"},{id:"grayscale",name:"Grayscale",icon:"fa-solid fa-brush",type:"toggle"},{id:"highlightLinks",name:"Highlight Links",icon:"fa-solid fa-link",type:"toggle"},{id:"hideImages",name:"Hide Images",icon:"fa-solid fa-image-slash",type:"toggle"},{id:"pauseAnimations",name:"Stop Animations",icon:"fa-solid fa-pause",type:"toggle"},{id:"reduceMotion",name:"Reduce Motion",icon:"fa-solid fa-person-walking",type:"toggle"},{id:"bigCursor",name:"Large Cursor",icon:"fa-solid fa-mouse-pointer",type:"toggle"},{id:"xlCursor",name:"XL Cursor",icon:"fa-solid fa-arrow-pointer",type:"toggle"},{id:"focusIndicator",name:"Focus Indicator",icon:"fa-solid fa-bullseye",type:"toggle"},{id:"tooltips",name:"Show Tooltips",icon:"fa-solid fa-comment-dots",type:"toggle"}],this.enabledFeatures=[...this.features]}init(){Object.entries(this.settings.getAll()).filter((e=>{let[t]=e;return this.features.some((e=>e.id===t))})).forEach((e=>{let[t,i]=e;i&&this.applyVisualSetting(t,i)})),this.events.on("settings:changed",((e,t)=>{this.features.some((e=>e.id===t))&&this.applyVisualSetting(t,e[t])})),this.handleColorSchemePreference()}applyVisualSetting(e,t){const i=document.body;if("contrast"===e||"smartContrast"===e||"contrastBlue"===e)return i.classList.remove("spicy-contrast","spicy-contrast-high","spicy-contrast-blue"),void(t&&("contrast"===e?i.classList.add("spicy-contrast-high"):"contrastBlue"===e?i.classList.add("spicy-contrast-blue"):"smartContrast"===e&&i.classList.add("spicy-contrast")));if("bigCursor"===e||"xlCursor"===e)return i.classList.remove("spicy-big-cursor","spicy-xl-cursor"),void(t&&("bigCursor"===e?i.classList.add("spicy-big-cursor"):"xlCursor"===e&&i.classList.add("spicy-xl-cursor")));if("pauseAnimations"===e||"reduceMotion"===e)return i.classList.remove("spicy-stop-motion","spicy-reduce-motion"),void(t&&("pauseAnimations"===e?i.classList.add("spicy-stop-motion"):"reduceMotion"===e&&i.classList.add("spicy-reduce-motion")));const s=`spicy-${e.replace(/([A-Z])/g,"-$1").toLowerCase()}`;i.classList.toggle(s,t)}handleColorSchemePreference(){const e=window.matchMedia("(prefers-color-scheme: dark)");e.matches&&!1===this.settings.getSetting("darkMode")&&!1===this.settings.getSetting("lightMode")&&this.settings.updateSetting("darkMode",!0),e.addEventListener("change",(e=>{!1===this.settings.getSetting("darkMode")&&!1===this.settings.getSetting("lightMode")&&this.settings.updateSetting("darkMode",e.matches)}))}renderSection(){if(0===this.enabledFeatures.length)return null;const e=i("div",{className:"spicy-section",innerHTML:'<h3><i class="fa-solid fa-circle-half-stroke"></i> Visual Display</h3>'}),t=i("div",{className:"spicy-grid"});return[["contrast","smartContrast","contrastBlue"],["darkMode","lightMode","grayscale"],["highlightLinks","hideImages"],["pauseAnimations","reduceMotion"],["bigCursor","xlCursor"],["focusIndicator","tooltips"]].forEach((e=>{this.enabledFeatures.filter((t=>e.includes(t.id))).forEach((e=>{const i=this.createFeatureButton(e);t.appendChild(i)}))})),t.children.length>0&&e.appendChild(t),e}createFeatureButton(e){const t=i("button",{className:"spicy-feature-btn",id:`spicy-${e.id}`,innerHTML:`\n        <i class="${e.icon}"></i>\n        <span>${e.name}</span>\n      `});return this.settings.getSetting(e.id)&&t.classList.add("active"),t.addEventListener("click",(()=>{const i=t.classList.toggle("active");if(i)if("darkMode"===e.id&&this.settings.getSetting("lightMode")){this.settings.updateSetting("lightMode",!1);const e=document.getElementById("spicy-lightMode");e&&e.classList.remove("active")}else if("lightMode"===e.id&&this.settings.getSetting("darkMode")){this.settings.updateSetting("darkMode",!1);const e=document.getElementById("spicy-darkMode");e&&e.classList.remove("active")}this.settings.updateSetting(e.id,i)})),t}updateUI(e){this.features.forEach((t=>{const i=document.getElementById(`spicy-${t.id}`);i&&i.classList.toggle("active",e[t.id])}))}}class d{constructor(e,t){this.settings=e,this.events=t,this.features=[{id:"pageStructure",name:"Page Structure",icon:"fa-solid fa-sitemap",type:"toggle"},{id:"readingGuide",name:"Reading Guide",icon:"fa-solid fa-ruler-horizontal",type:"toggle"},{id:"tooltips",name:"Show Tooltips",icon:"fa-solid fa-comment",type:"toggle"}],this.enabledFeatures=[...this.features],this.handlers={}}init(){const e=this.settings.getAll();e.pageStructure&&this.showPageStructure(),e.readingGuide&&this.enableReadingGuide(),e.tooltips&&this.toggleTooltips(!0),this.events.on("settings:changed",((e,t)=>{"pageStructure"===t?e.pageStructure?this.showPageStructure():this.hidePageStructure():"readingGuide"===t?e.readingGuide?this.enableReadingGuide():this.disableReadingGuide():"tooltips"===t&&this.toggleTooltips(e.tooltips)}))}applySettings(e){e.pageStructure!==this.lastSettings?.pageStructure&&(e.pageStructure?this.showPageStructure():this.hidePageStructure()),e.readingGuide!==this.lastSettings?.readingGuide&&(e.readingGuide?this.createReadingGuide():this.removeReadingGuide()),document.body.classList.toggle("spicy-tooltips",e.tooltips),this.lastSettings={...e}}renderSection(){if(0===this.enabledFeatures.length)return null;const e=i("div",{className:"spicy-section",innerHTML:'<h3><i class="fa-solid fa-sitemap"></i> Navigation</h3>'}),t=i("div",{className:"spicy-grid"});return this.enabledFeatures.forEach((e=>{const i=this.createFeatureButton(e);t.appendChild(i)})),t.children.length>0&&e.appendChild(t),e}createFeatureButton(e){const t=i("button",{className:"spicy-feature-btn",id:`spicy-${e.id}`,innerHTML:`\n        <i class="${e.icon}"></i>\n        <span>${e.name}</span>\n      `});return this.settings.getSetting(e.id)&&t.classList.add("active"),t.addEventListener("click",(()=>{const i=t.classList.toggle("active");this.settings.updateSetting(e.id,i)})),t}updateUI(e){this.features.forEach((t=>{const i=document.getElementById(`spicy-${t.id}`);i&&i.classList.toggle("active",e[t.id])}))}showPageStructure(){if(document.getElementById("spicy-structure-panel"))return void(document.getElementById("spicy-structure-panel").style.display="block");const e=i("div",{id:"spicy-structure-panel",innerHTML:'\n        <h3>Page Structure</h3>\n        <div class="spicy-panel-header">\n          <button id="spicy-structure-close" aria-label="Close structure panel">\n            <i class="fa-solid fa-xmark"></i>\n          </button>\n        </div>\n        <ul id="spicy-structure-list"></ul>\n      '});e.querySelector("#spicy-structure-close").addEventListener("click",(()=>{this.settings.updateSetting("pageStructure",!1);const e=document.getElementById("spicy-pageStructure");e&&e.classList.remove("active")})),this.handlers.structureFocusTrap=function(e){const t=e.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(0===t.length)return()=>{};const i=t[0],s=t[t.length-1],n=e=>{"Tab"===e.key&&(e.shiftKey?document.activeElement===i&&(e.preventDefault(),s.focus()):document.activeElement===s&&(e.preventDefault(),i.focus()))};return e.addEventListener("keydown",n),()=>{e.removeEventListener("keydown",n)}}(e),document.body.appendChild(e),this.populateStructurePanel()}populateStructurePanel(){const e=document.getElementById("spicy-structure-list");if(!e)return;e.innerHTML="";const t=document.querySelectorAll("h1, h2, h3, h4, h5, h6");0!==t.length?t.forEach(((t,s)=>{const n=i("li",{className:`heading-level-${t.tagName.charAt(1)}`,textContent:t.textContent.trim()||`[Empty heading ${s+1}]`});n.addEventListener("click",(()=>{let e=t.id;e||(e=`spicy-heading-${s}`,t.id=e),t.scrollIntoView({behavior:"smooth"}),t.setAttribute("tabindex","-1"),t.focus(),t.hasAttribute("id")||setTimeout((()=>{t.removeAttribute("id")}),1e3)})),e.appendChild(n)})):e.innerHTML='<li class="spicy-no-headings">No headings found on this page</li>'}hidePageStructure(){const e=document.getElementById("spicy-structure-panel");e&&(e.style.display="none"),this.handlers.structureFocusTrap&&(this.handlers.structureFocusTrap(),delete this.handlers.structureFocusTrap)}createReadingGuide(){if(document.getElementById("spicy-reading-guide"))return void(document.getElementById("spicy-reading-guide").style.display="block");const e=i("div",{id:"spicy-reading-guide"});document.body.appendChild(e),this.handlers.readingGuideHandler=t=>{e&&(e.style.display="block",e.style.top=t.clientY-20+"px")},document.addEventListener("mousemove",this.handlers.readingGuideHandler)}removeReadingGuide(){const e=document.getElementById("spicy-reading-guide");e&&(e.style.display="none"),this.handlers.readingGuideHandler&&(document.removeEventListener("mousemove",this.handlers.readingGuideHandler),delete this.handlers.readingGuideHandler)}toggleTooltips(e){if(e){document.body.classList.add("spicy-tooltips");document.querySelectorAll('[title]:not([title=""])').forEach((e=>{if(e.dataset.processingTooltip)return;e.dataset.processingTooltip="true";const t=e.getAttribute("title");e.dataset.spicyTooltip=t,e.removeAttribute("title"),e.addEventListener("mouseenter",(function(){this.setAttribute("title",this.dataset.spicyTooltip)})),e.addEventListener("mouseleave",(function(){this.removeAttribute("title")}))}))}else document.body.classList.remove("spicy-tooltips"),document.querySelectorAll("[data-spicy-tooltip]").forEach((e=>{e.setAttribute("title",e.dataset.spicyTooltip),delete e.dataset.processingTooltip}))}}class p{constructor(e,t){this.settings=e,this.events=t,this.features=[{id:"textToSpeech",name:"Screen Reader",icon:"fa-solid fa-volume-high",type:"toggle"}],this.enabledFeatures=[...this.features],this.isSpeaking=!1,this.selectedVoice=null,this.readingRate=1}init(){this.isSpeechAvailable="speechSynthesis"in window,this.isSpeechAvailable||(console.warn("Speech synthesis not available in this browser"),this.enabledFeatures=this.enabledFeatures.filter((e=>"textToSpeech"!==e.id))),this.applySettings(this.settings.getAll()),this.events.on("settings:changed",this.applySettings.bind(this)),this.events.on("panel:closed",(()=>{this.isSpeaking&&(window.speechSynthesis.cancel(),this.isSpeaking=!1)}))}applySettings(e){e.textToSpeech!==this.lastSettings?.textToSpeech&&(e.textToSpeech?this.initializeScreenReader():this.disableScreenReader()),this.lastSettings={...e}}renderSection(){if(0===this.enabledFeatures.length||!this.isSpeechAvailable)return null;const e=i("div",{className:"spicy-section",innerHTML:'<h3><i class="fa-solid fa-headphones"></i> Audio & Speech</h3>'}),t=i("div",{className:"spicy-grid"});return this.enabledFeatures.forEach((e=>{const i=this.createFeatureButton(e);t.appendChild(i)})),t.children.length>0&&e.appendChild(t),e}createFeatureButton(e){const t=i("button",{className:"spicy-feature-btn",id:`spicy-${e.id}`,innerHTML:`\n        <i class="${e.icon}"></i>\n        <span>${e.name}</span>\n      `});return this.settings.getSetting(e.id)&&t.classList.add("active"),t.addEventListener("click",(()=>{const i=t.classList.toggle("active");this.settings.updateSetting(e.id,i)})),t}updateUI(e){this.features.forEach((t=>{const i=document.getElementById(`spicy-${t.id}`);i&&i.classList.toggle("active",e[t.id])}))}initializeScreenReader(){if(!this.isSpeechAvailable)return;if(document.getElementById("spicy-reader-controls"))return void(document.getElementById("spicy-reader-controls").style.display="flex");const e=i("div",{id:"spicy-reader-controls",innerHTML:'\n        <button id="spicy-reader-play" aria-label="Play screen reader">\n          <i class="fa-solid fa-play"></i>\n        </button>\n        <button id="spicy-reader-pause" aria-label="Pause screen reader">\n          <i class="fa-solid fa-pause"></i>\n        </button>\n        <button id="spicy-reader-stop" aria-label="Stop screen reader">\n          <i class="fa-solid fa-stop"></i>\n        </button>\n        <select id="spicy-reader-voice" aria-label="Select voice"></select>\n        <input type="range" id="spicy-reader-rate" aria-label="Reading speed" min="0.5" max="2" step="0.1" value="1">\n      '});document.body.appendChild(e),this.populateVoices(),document.getElementById("spicy-reader-play").addEventListener("click",(()=>{this.readSelectedText()})),document.getElementById("spicy-reader-pause").addEventListener("click",(()=>{window.speechSynthesis.speaking&&(this.isSpeaking?(window.speechSynthesis.pause(),this.isSpeaking=!1):(window.speechSynthesis.resume(),this.isSpeaking=!0))})),document.getElementById("spicy-reader-stop").addEventListener("click",(()=>{window.speechSynthesis.cancel(),this.isSpeaking=!1})),document.getElementById("spicy-reader-rate").addEventListener("input",(e=>{this.readingRate=parseFloat(e.target.value)})),document.getElementById("spicy-reader-voice").addEventListener("change",(e=>{this.selectedVoice=e.target.value})),document.addEventListener("mouseup",(()=>{const e=window.getSelection();e&&e.toString().trim().length>0?document.getElementById("spicy-reader-play").classList.add("active"):document.getElementById("spicy-reader-play").classList.remove("active")}))}populateVoices(){if(!this.isSpeechAvailable)return;const e=document.getElementById("spicy-reader-voice");if(!e)return;e.innerHTML="";const t=window.speechSynthesis.getVoices();t.forEach(((t,s)=>{const n=i("option",{value:s,textContent:`${t.name} (${t.lang})`});e.appendChild(n)})),t.length>0&&(this.selectedVoice=0)}readSelectedText(){if(!this.isSpeechAvailable)return;const e=window.getSelection().toString();if(!e)return void alert("Please select text to read aloud");const t=new SpeechSynthesisUtterance(e),i=window.speechSynthesis.getVoices();i.length>0&&null!==this.selectedVoice&&(t.voice=i[this.selectedVoice]),t.rate=this.readingRate,t.onstart=()=>{this.isSpeaking=!0},t.onend=()=>{this.isSpeaking=!1},t.onerror=e=>{console.error("Speech synthesis error:",e),this.isSpeaking=!1},window.speechSynthesis.cancel(),window.speechSynthesis.speak(t)}disableScreenReader(){this.isSpeechAvailable&&(window.speechSynthesis.cancel(),this.isSpeaking=!1);const e=document.getElementById("spicy-reader-controls");e&&(e.style.display="none")}}class g{constructor(e,t){this.settings=e,this.events=t,this.features=[]}init(){this.events.on("settings:profile:loaded",this.handleProfileLoaded.bind(this)),this.events.on("settings:profile:saved",this.handleProfileSaved.bind(this)),this.events.on("settings:profile:deleted",this.handleProfileDeleted.bind(this))}renderSection(){const e=i("div",{className:"spicy-section",innerHTML:'<h3><i class="fa-solid fa-user-gear"></i> Profiles</h3>'}),t=i("div",{className:"spicy-profile-controls"}),s=i("select",{id:"spicy-profile-select",attributes:{"aria-label":"Select accessibility profile"}});this.populateProfileSelect(s);const n=i("button",{className:"spicy-btn",id:"spicy-save-profile",innerHTML:'<i class="fa-solid fa-floppy-disk"></i> Save'}),o=i("button",{className:"spicy-btn spicy-reset",id:"spicy-delete-profile",innerHTML:'<i class="fa-solid fa-trash"></i>',style:{padding:"8px 12px"}});s.addEventListener("change",(()=>{const e=s.value;this.settings.loadProfile(e)})),n.addEventListener("click",(()=>{this.saveCurrentProfile()})),o.addEventListener("click",(()=>{this.deleteCurrentProfile()})),t.appendChild(s),t.appendChild(n),t.appendChild(o);const a=i("div",{style:{marginTop:"10px",display:"flex",gap:"8px"}}),r=i("input",{id:"spicy-custom-profile-name",attributes:{type:"text",placeholder:"Create new profile...","aria-label":"New profile name"},style:{flexGrow:"1",padding:"8px 12px",borderRadius:"6px",border:"1px solid var(--spicy-border)",fontSize:"14px"}}),l=i("button",{className:"spicy-btn",id:"spicy-create-profile",innerHTML:'<i class="fa-solid fa-plus"></i> Create',style:{whiteSpace:"nowrap"}});return l.addEventListener("click",(()=>{this.createNewProfile()})),a.appendChild(r),a.appendChild(l),e.appendChild(t),e.appendChild(a),e}populateProfileSelect(e){e.innerHTML="";const t=this.settings.getProfiles();Object.keys(t).forEach((t=>{const s=i("option",{value:t,textContent:this.formatProfileName(t)});e.appendChild(s)}));const s=this.getCurrentProfileName();e.value=s||"default"}formatProfileName(e){const t={default:"Default",highContrast:"High Contrast",dyslexic:"Dyslexia-friendly",senior:"Senior-friendly",lowVision:"Low Vision",motor:"Motor Disabilities",cognitive:"Cognitive Support"};return e in t?t[e]:e.replace(/([A-Z])/g," $1").replace(/^./,(e=>e.toUpperCase()))}getCurrentProfileName(){const e=this.settings.getAll(),t=this.settings.getProfiles();for(const[i,s]of Object.entries(t)){if(Object.entries(s).every((t=>{let[i,s]=t;return e[i]===s})))return i}return null}saveCurrentProfile(){const e=document.getElementById("spicy-profile-select").value;if("default"===e){const e=prompt("Cannot overwrite the default profile. Enter a name for your custom profile:");if(!e)return;if(this.settings.saveProfile(e))return void this.updateProfileSelect(e)}else{if(!window.confirm(`Are you sure you want to overwrite the "${this.formatProfileName(e)}" profile?`))return;this.settings.saveProfile(e)}}createNewProfile(){const e=document.getElementById("spicy-custom-profile-name"),t=e.value.trim();if(!t)return void alert("Please enter a name for your profile");this.settings.saveProfile(t)&&(e.value="",this.updateProfileSelect(t))}deleteCurrentProfile(){const e=document.getElementById("spicy-profile-select").value;if(["default","highContrast","dyslexic","senior","lowVision","motor","cognitive"].includes(e))return void alert(`Cannot delete the built-in "${this.formatProfileName(e)}" profile`);if(!window.confirm(`Are you sure you want to delete the "${this.formatProfileName(e)}" profile?`))return;this.settings.deleteProfile(e)&&(this.settings.loadProfile("default"),this.updateProfileSelect("default"))}updateProfileSelect(e){const t=document.getElementById("spicy-profile-select");this.populateProfileSelect(t),t.value=e}handleProfileLoaded(e){const t=document.getElementById("spicy-profile-select");t&&(t.value=e)}handleProfileSaved(e){document.getElementById("spicy-profile-select")&&this.updateProfileSelect(e)}handleProfileDeleted(){document.getElementById("spicy-profile-select")&&this.updateProfileSelect("default")}}const u={position:"bottom-right",features:"all",initialProfile:"default",language:"en",theme:"light",keyboardShortcut:"alt+a",autoSave:!0,debug:!0},h={init(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};console.log("SpicyAccessibility initialization started");try{"undefined"!=typeof window&&(window.SpicyAccessibility=this),this.config={...u,...e},this.open=this.open||function(){this.widget&&this.widget.openPanel()},this.close=this.close||function(){this.widget&&this.widget.closePanel()},this.toggle=this.toggle||function(){this.widget&&this.widget.togglePanel()};const t=new Promise((e=>{if(document.querySelector('link[href*="font-awesome"]'))return void e();const t=document.createElement("link");t.rel="stylesheet",t.href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css",t.onload=e,t.onerror=()=>{console.warn("Failed to load Font Awesome, falling back to text"),e()},document.head.appendChild(t)}));this.events=new a,console.log("EventBus initialized"),this.storage=new o(this.config.autoSave),console.log("Storage initialized"),this.settings=new n(this.storage,this.events),console.log("Settings initialized"),this.settings.load(),console.log("Settings loaded");try{this.widget=new s(this.config,this.settings,this.events),console.log("Widget initialized")}catch(e){console.error("Error initializing widget:",e),this.createEmergencyButton()}if(this.widget)try{this._registerFeatures(),console.log("Features registered")}catch(e){console.error("Error registering features:",e)}t.then((()=>{this.widget&&(this.widget.render().catch((e=>{console.error("Error rendering widget:",e),this.createEmergencyButton()})),console.log("Widget render called"),"default"!==this.config.initialProfile&&(this.settings.loadProfile(this.config.initialProfile),console.log(`Applied initial profile: ${this.config.initialProfile}`))),console.log("SpicyAccessibility initialization completed"),setTimeout((()=>{document.getElementById("spicy-access-btn")||(console.warn("Widget button not found after initialization"),this.createEmergencyButton())}),2e3)}))}catch(e){console.error("Error initializing SpicyAccessibility:",e),this.createEmergencyButton()}return this},_registerFeatures(){try{const e=[new l(this.settings,this.events),new c(this.settings,this.events),new d(this.settings,this.events),new p(this.settings,this.events),new g(this.settings,this.events)];Array.isArray(this.config.features)&&"all"!==this.config.features&&e.forEach((e=>{e.enabledFeatures=e.features.filter((e=>this.config.features.includes(e.id)))})),e.forEach((e=>{this.widget.registerFeatureModule(e)}))}catch(e){console.error("Error registering features:",e)}},applyProfile(e){this.settings&&this.settings.loadProfile(e)},enableFeature(e){this.settings&&this.settings.updateSetting(e,!0)},disableFeature(e){this.settings&&this.settings.updateSetting(e,!1)},reset(){this.settings&&this.settings.resetAll()},getSettings(){return this.settings?this.settings.getAll():{}},createEmergencyButton(){if(document.getElementById("emergency-a11y-btn")||document.getElementById("spicy-access-btn"))return;console.warn("Creating emergency accessibility button");const e=document.createElement("button");e.id="emergency-a11y-btn",e.innerHTML='<span style="font-weight:bold;">A11Y</span>',e.style.cssText="\n      position: fixed !important;\n      bottom: 20px !important;\n      right: 20px !important;\n      z-index: 10000 !important;\n      width: auto !important;\n      min-width: 56px !important;\n      height: 56px !important;\n      padding: 0 15px !important;\n      background-color: #4265ED !important;\n      color: white !important;\n      border: none !important;\n      border-radius: 28px !important;\n      font-size: 16px !important;\n      box-shadow: 0 4px 16px rgba(0,0,0,0.2) !important;\n      display: flex !important;\n      align-items: center !important;\n      justify-content: center !important;\n      cursor: pointer !important;\n    ",document.body.appendChild(e),e.addEventListener("click",(()=>{if(this.widget&&"function"==typeof this.widget.togglePanel)try{this.widget.togglePanel()}catch(e){if(console.error("Error toggling panel:",e),alert("Accessibility panel would open here, but there was an issue with the widget implementation."),this.widget&&"function"==typeof this.widget.initialize)try{this.widget.initialize(),setTimeout((()=>this.widget.togglePanel()),500)}catch(e){console.error("Failed to reinitialize widget:",e)}}else alert("Accessibility panel would open here, but there was an issue with the widget initialization.")}))}};return"undefined"!=typeof window&&(window.debugSpicyAccessibility=function(){if(console.log("Running accessibility widget debug..."),!window.SpicyAccessibility)return void console.error("SpicyAccessibility object not found in window.");console.log("SpicyAccessibility found:",window.SpicyAccessibility);const{widget:e,settings:t,events:i,storage:s}=window.SpicyAccessibility;if(!e)return void console.error("Widget not found in SpicyAccessibility");if(document.getElementById("spicy-access-btn")?console.log("Widget button found in DOM"):(console.warn("Widget button not found in DOM, attempting to reinitialize..."),"function"==typeof e.initialize?e.initialize():console.error("Cannot reinitialize widget - initialize method not found")),document.querySelector('link[href*="font-awesome"]'))console.log("Font Awesome is loaded");else{console.warn("Font Awesome not loaded, attempting to load...");const e=document.createElement("link");e.rel="stylesheet",e.href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css",document.head.appendChild(e),console.log("Font Awesome link added to head")}e.featureModules&&e.featureModules.length>0?console.log(`Found ${e.featureModules.length} feature modules`):console.warn("No feature modules found, widget may not function correctly");const n=document.getElementById("spicy-access-btn");return n&&!n.innerHTML.includes("fa-")&&(console.warn("Toggle button found but icon may be missing, recreating..."),n.parentNode&&n.parentNode.removeChild(n),e.createToggleButton(),console.log("Toggle button recreated")),console.log("Debug complete - check console for any errors"),"Debug complete. If the widget is still not working, please refresh the page and try again."}),t=t.default})()));